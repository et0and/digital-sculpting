mirrors–t
(function(a,b){
"use strict";
var c;
var d=a.Array;
var e=a.isNaN;
var f=a.JSON.stringify;
var g;
var h;
var i;
var j=a.Math.min;
var k=b.ImportNow("promise_status_symbol");
var l=b.ImportNow("promise_value_symbol");
var m;
var n;
var o;
b.Import(function(p){
c=p.ErrorToString;
g=p.MakeError;
h=p.MapEntries;
i=p.MapIteratorNext;
m=p.SetIteratorNext;
n=p.SetValues;
o=p.SymbolToString;
});
var q={
UNDEFINED_TYPE:'undefined',
NULL_TYPE:'null',
BOOLEAN_TYPE:'boolean',
NUMBER_TYPE:'number',
STRING_TYPE:'string',
SYMBOL_TYPE:'symbol',
OBJECT_TYPE:'object',
FUNCTION_TYPE:'function',
REGEXP_TYPE:'regexp',
ERROR_TYPE:'error',
PROPERTY_TYPE:'property',
INTERNAL_PROPERTY_TYPE:'internalProperty',
FRAME_TYPE:'frame',
SCRIPT_TYPE:'script',
CONTEXT_TYPE:'context',
SCOPE_TYPE:'scope',
PROMISE_TYPE:'promise',
MAP_TYPE:'map',
SET_TYPE:'set',
ITERATOR_TYPE:'iterator',
GENERATOR_TYPE:'generator',
}
var r=0;
var s=-1;
var t=[];
var u=true;
function MirrorCacheIsEmpty(){
return r==0&&t.length==0;
}
function ToggleMirrorCache(v){
u=v;
ClearMirrorCache();
}
function ClearMirrorCache(v){
r=0;
t=[];
}
function ObjectIsPromise(v){
return(%_IsJSReceiver(v))&&
!(%DebugGetProperty(v,k)===(void 0));
}
function MakeMirror(v,w){
var x;
if(!w&&u){
for(var y in t){
x=t[y];
if(x.value()===v){
return x;
}
if(x.isNumber()&&e(x.value())&&
typeof v=='number'&&e(v)){
return x;
}
}
}
if((v===(void 0))){
x=new UndefinedMirror();
}else if((v===null)){
x=new NullMirror();
}else if((typeof(v)==='boolean')){
x=new BooleanMirror(v);
}else if((typeof(v)==='number')){
x=new NumberMirror(v);
}else if((typeof(v)==='string')){
x=new StringMirror(v);
}else if((typeof(v)==='symbol')){
x=new SymbolMirror(v);
}else if((%_IsArray(v))){
x=new ArrayMirror(v);
}else if((%_IsDate(v))){
x=new DateMirror(v);
}else if((%_IsFunction(v))){
x=new FunctionMirror(v);
}else if((%_IsRegExp(v))){
x=new RegExpMirror(v);
}else if((%_ClassOf(v)==='Error')){
x=new ErrorMirror(v);
}else if((%_ClassOf(v)==='Script')){
x=new ScriptMirror(v);
}else if((%_ClassOf(v)==='Map')||(%_ClassOf(v)==='WeakMap')){
x=new MapMirror(v);
}else if((%_ClassOf(v)==='Set')||(%_ClassOf(v)==='WeakSet')){
x=new SetMirror(v);
}else if((%_ClassOf(v)==='Map Iterator')||(%_ClassOf(v)==='Set Iterator')){
x=new IteratorMirror(v);
}else if(ObjectIsPromise(v)){
x=new PromiseMirror(v);
}else if((%_ClassOf(v)==='Generator')){
x=new GeneratorMirror(v);
}else{
x=new ObjectMirror(v,q.OBJECT_TYPE,w);
}
if(u)t[x.handle()]=x;
return x;
}
function LookupMirror(z){
if(!u){
throw g(2,"Mirror cache is disabled");
}
return t[z];
}
function GetUndefinedMirror(){
return MakeMirror((void 0));
}
function inherits(A,B){
var C=function(){};
C.prototype=B.prototype;
A.super_=B.prototype;
A.prototype=new C();
A.prototype.constructor=A;
}
var D=80;
var E={};
E.Data=0;
E.DataConstant=2;
E.AccessorConstant=3;
var F={};
F.None=0;
F.ReadOnly=1;
F.DontEnum=2;
F.DontDelete=4;
var G={Global:0,
Local:1,
With:2,
Closure:3,
Catch:4,
Block:5,
Script:6};
function Mirror(H){
this.type_=H;
}
Mirror.prototype.type=function(){
return this.type_;
};
Mirror.prototype.isValue=function(){
return this instanceof ValueMirror;
};
Mirror.prototype.isUndefined=function(){
return this instanceof UndefinedMirror;
};
Mirror.prototype.isNull=function(){
return this instanceof NullMirror;
};
Mirror.prototype.isBoolean=function(){
return this instanceof BooleanMirror;
};
Mirror.prototype.isNumber=function(){
return this instanceof NumberMirror;
};
Mirror.prototype.isString=function(){
return this instanceof StringMirror;
};
Mirror.prototype.isSymbol=function(){
return this instanceof SymbolMirror;
};
Mirror.prototype.isObject=function(){
return this instanceof ObjectMirror;
};
Mirror.prototype.isFunction=function(){
return this instanceof FunctionMirror;
};
Mirror.prototype.isUnresolvedFunction=function(){
return this instanceof UnresolvedFunctionMirror;
};
Mirror.prototype.isArray=function(){
return this instanceof ArrayMirror;
};
Mirror.prototype.isDate=function(){
return this instanceof DateMirror;
};
Mirror.prototype.isRegExp=function(){
return this instanceof RegExpMirror;
};
Mirror.prototype.isError=function(){
return this instanceof ErrorMirror;
};
Mirror.prototype.isPromise=function(){
return this instanceof PromiseMirror;
};
Mirror.prototype.isGenerator=function(){
return this instanceof GeneratorMirror;
};
Mirror.prototype.isProperty=function(){
return this instanceof PropertyMirror;
};
Mirror.prototype.isInternalProperty=function(){
return this instanceof InternalPropertyMirror;
};
Mirror.prototype.isFrame=function(){
return this instanceof FrameMirror;
};
Mirror.prototype.isScript=function(){
return this instanceof ScriptMirror;
};
Mirror.prototype.isContext=function(){
return this instanceof ContextMirror;
};
Mirror.prototype.isScope=function(){
return this instanceof ScopeMirror;
};
Mirror.prototype.isMap=function(){
return this instanceof MapMirror;
};
Mirror.prototype.isSet=function(){
return this instanceof SetMirror;
};
Mirror.prototype.isIterator=function(){
return this instanceof IteratorMirror;
};
Mirror.prototype.allocateHandle_=function(){
if(u)this.handle_=r++;
};
Mirror.prototype.allocateTransientHandle_=function(){
this.handle_=s--;
};
Mirror.prototype.toText=function(){
return"#<"+this.constructor.name+">";
};
function ValueMirror(H,v,I){
%_Call(Mirror,this,H);
this.value_=v;
if(!I){
this.allocateHandle_();
}else{
this.allocateTransientHandle_();
}
}
inherits(ValueMirror,Mirror);
Mirror.prototype.handle=function(){
return this.handle_;
};
ValueMirror.prototype.isPrimitive=function(){
var H=this.type();
return H==='undefined'||
H==='null'||
H==='boolean'||
H==='number'||
H==='string'||
H==='symbol';
};
ValueMirror.prototype.value=function(){
return this.value_;
};
function UndefinedMirror(){
%_Call(ValueMirror,this,q.UNDEFINED_TYPE,(void 0));
}
inherits(UndefinedMirror,ValueMirror);
UndefinedMirror.prototype.toText=function(){
return'undefined';
};
function NullMirror(){
%_Call(ValueMirror,this,q.NULL_TYPE,null);
}
inherits(NullMirror,ValueMirror);
NullMirror.prototype.toText=function(){
return'null';
};
function BooleanMirror(v){
%_Call(ValueMirror,this,q.BOOLEAN_TYPE,v);
}
inherits(BooleanMirror,ValueMirror);
BooleanMirror.prototype.toText=function(){
return this.value_?'true':'false';
};
function NumberMirror(v){
%_Call(ValueMirror,this,q.NUMBER_TYPE,v);
}
inherits(NumberMirror,ValueMirror);
NumberMirror.prototype.toText=function(){
return %_NumberToString(this.value_);
};
function StringMirror(v){
%_Call(ValueMirror,this,q.STRING_TYPE,v);
}
inherits(StringMirror,ValueMirror);
StringMirror.prototype.length=function(){
return this.value_.length;
};
StringMirror.prototype.getTruncatedValue=function(J){
if(J!=-1&&this.length()>J){
return this.value_.substring(0,J)+
'... (length: '+this.length()+')';
}
return this.value_;
};
StringMirror.prototype.toText=function(){
return this.getTruncatedValue(D);
};
function SymbolMirror(v){
%_Call(ValueMirror,this,q.SYMBOL_TYPE,v);
}
inherits(SymbolMirror,ValueMirror);
SymbolMirror.prototype.description=function(){
return %SymbolDescription(%_ValueOf(this.value_));
}
SymbolMirror.prototype.toText=function(){
return %_Call(o,this.value_);
}
function ObjectMirror(v,H,I){
H=H||q.OBJECT_TYPE;
%_Call(ValueMirror,this,H,v,I);
}
inherits(ObjectMirror,ValueMirror);
ObjectMirror.prototype.className=function(){
return %_ClassOf(this.value_);
};
ObjectMirror.prototype.constructorFunction=function(){
return MakeMirror(%DebugGetProperty(this.value_,'constructor'));
};
ObjectMirror.prototype.prototypeObject=function(){
return MakeMirror(%DebugGetProperty(this.value_,'prototype'));
};
ObjectMirror.prototype.protoObject=function(){
return MakeMirror(%DebugGetPrototype(this.value_));
};
ObjectMirror.prototype.hasNamedInterceptor=function(){
var K=%GetInterceptorInfo(this.value_);
return(K&2)!=0;
};
ObjectMirror.prototype.hasIndexedInterceptor=function(){
var K=%GetInterceptorInfo(this.value_);
return(K&1)!=0;
};
ObjectMirror.prototype.propertyNames=function(){
return %GetOwnPropertyKeys(this.value_,0);
};
ObjectMirror.prototype.properties=function(){
var L=this.propertyNames();
var M=new d(L.length);
for(var N=0;N<L.length;N++){
M[N]=this.property(L[N]);
}
return M;
};
ObjectMirror.prototype.internalProperties=function(){
return ObjectMirror.GetInternalProperties(this.value_);
}
ObjectMirror.prototype.property=function(O){
var P=%DebugGetPropertyDetails(this.value_,(%_ToName(O)));
if(P){
return new PropertyMirror(this,O,P);
}
return GetUndefinedMirror();
};
ObjectMirror.prototype.lookupProperty=function(v){
var M=this.properties();
for(var N=0;N<M.length;N++){
var Q=M[N];
if(Q.propertyType()!=E.AccessorConstant){
if(%_ObjectEquals(Q.value_,v.value_)){
return Q;
}
}
}
return GetUndefinedMirror();
};
ObjectMirror.prototype.referencedBy=function(R){
var S=%DebugReferencedBy(this.value_,
Mirror.prototype,R||0);
for(var N=0;N<S.length;N++){
S[N]=MakeMirror(S[N]);
}
return S;
};
ObjectMirror.prototype.toText=function(){
var O;
var A=this.constructorFunction();
if(!A.isFunction()){
O=this.className();
}else{
O=A.name();
if(!O){
O=this.className();
}
}
return'#<'+O+'>';
};
ObjectMirror.GetInternalProperties=function(v){
var M=%DebugGetInternalProperties(v);
var S=[];
for(var N=0;N<M.length;N+=2){
S.push(new InternalPropertyMirror(M[N],M[N+1]));
}
return S;
}
function FunctionMirror(v){
%_Call(ObjectMirror,this,v,q.FUNCTION_TYPE);
this.resolved_=true;
}
inherits(FunctionMirror,ObjectMirror);
FunctionMirror.prototype.resolved=function(){
return this.resolved_;
};
FunctionMirror.prototype.name=function(){
return %FunctionGetName(this.value_);
};
FunctionMirror.prototype.debugName=function(){
return %FunctionGetDebugName(this.value_);
}
FunctionMirror.prototype.inferredName=function(){
return %FunctionGetInferredName(this.value_);
};
FunctionMirror.prototype.source=function(){
if(this.resolved()){
return %FunctionToString(this.value_);
}
};
FunctionMirror.prototype.script=function(){
if(this.resolved()){
if(this.script_){
return this.script_;
}
var T=%FunctionGetScript(this.value_);
if(T){
return this.script_=MakeMirror(T);
}
}
};
FunctionMirror.prototype.sourcePosition_=function(){
if(this.resolved()){
return %FunctionGetScriptSourcePosition(this.value_);
}
};
FunctionMirror.prototype.sourceLocation=function(){
if(this.resolved()){
var T=this.script();
if(T){
return T.locationFromPosition(this.sourcePosition_(),true);
}
}
};
FunctionMirror.prototype.constructedBy=function(U){
if(this.resolved()){
var S=%DebugConstructedBy(this.value_,U||0);
for(var N=0;N<S.length;N++){
S[N]=MakeMirror(S[N]);
}
return S;
}else{
return[];
}
};
FunctionMirror.prototype.scopeCount=function(){
if(this.resolved()){
if((this.scopeCount_===(void 0))){
this.scopeCount_=%GetFunctionScopeCount(this.value());
}
return this.scopeCount_;
}else{
return 0;
}
};
FunctionMirror.prototype.scope=function(V){
if(this.resolved()){
return new ScopeMirror((void 0),this,V);
}
};
FunctionMirror.prototype.toText=function(){
return this.source();
};
function UnresolvedFunctionMirror(v){
%_Call(ValueMirror,this,q.FUNCTION_TYPE,v);
this.propertyCount_=0;
this.elementCount_=0;
this.resolved_=false;
}
inherits(UnresolvedFunctionMirror,FunctionMirror);
UnresolvedFunctionMirror.prototype.className=function(){
return'Function';
};
UnresolvedFunctionMirror.prototype.constructorFunction=function(){
return GetUndefinedMirror();
};
UnresolvedFunctionMirror.prototype.prototypeObject=function(){
return GetUndefinedMirror();
};
UnresolvedFunctionMirror.prototype.protoObject=function(){
return GetUndefinedMirror();
};
UnresolvedFunctionMirror.prototype.name=function(){
return this.value_;
};
UnresolvedFunctionMirror.prototype.inferredName=function(){
return(void 0);
};
UnresolvedFunctionMirror.prototype.propertyNames=function(W,X){
return[];
};
function ArrayMirror(v){
%_Call(ObjectMirror,this,v);
}
inherits(ArrayMirror,ObjectMirror);
ArrayMirror.prototype.length=function(){
return this.value_.length;
};
ArrayMirror.prototype.indexedPropertiesFromRange=function(opt_from_index,
opt_to_index){
var Y=opt_from_index||0;
var Z=opt_to_index||this.length()-1;
if(Y>Z)return new d();
var aa=new d(Z-Y+1);
for(var N=Y;N<=Z;N++){
var P=%DebugGetPropertyDetails(this.value_,(%_ToString(N)));
var v;
if(P){
v=new PropertyMirror(this,N,P);
}else{
v=GetUndefinedMirror();
}
aa[N-Y]=v;
}
return aa;
};
function DateMirror(v){
%_Call(ObjectMirror,this,v);
}
inherits(DateMirror,ObjectMirror);
DateMirror.prototype.toText=function(){
var ab=f(this.value_);
return ab.substring(1,ab.length-1);
};
function RegExpMirror(v){
%_Call(ObjectMirror,this,v,q.REGEXP_TYPE);
}
inherits(RegExpMirror,ObjectMirror);
RegExpMirror.prototype.source=function(){
return this.value_.source;
};
RegExpMirror.prototype.global=function(){
return this.value_.global;
};
RegExpMirror.prototype.ignoreCase=function(){
return this.value_.ignoreCase;
};
RegExpMirror.prototype.multiline=function(){
return this.value_.multiline;
};
RegExpMirror.prototype.sticky=function(){
return this.value_.sticky;
};
RegExpMirror.prototype.unicode=function(){
return this.value_.unicode;
};
RegExpMirror.prototype.toText=function(){
return"/"+this.source()+"/";
};
function ErrorMirror(v){
%_Call(ObjectMirror,this,v,q.ERROR_TYPE);
}
inherits(ErrorMirror,ObjectMirror);
ErrorMirror.prototype.message=function(){
return this.value_.message;
};
ErrorMirror.prototype.toText=function(){
var ac;
try{
ac=%_Call(c,this.value_);
}catch(e){
ac='#<Error>';
}
return ac;
};
function PromiseMirror(v){
%_Call(ObjectMirror,this,v,q.PROMISE_TYPE);
}
inherits(PromiseMirror,ObjectMirror);
function PromiseGetStatus_(v){
var ad=%DebugGetProperty(v,k);
if(ad==0)return"pending";
if(ad==1)return"resolved";
return"rejected";
}
function PromiseGetValue_(v){
return %DebugGetProperty(v,l);
}
PromiseMirror.prototype.status=function(){
return PromiseGetStatus_(this.value_);
};
PromiseMirror.prototype.promiseValue=function(){
return MakeMirror(PromiseGetValue_(this.value_));
};
function MapMirror(v){
%_Call(ObjectMirror,this,v,q.MAP_TYPE);
}
inherits(MapMirror,ObjectMirror);
MapMirror.prototype.entries=function(ae){
var S=[];
if((%_ClassOf(this.value_)==='WeakMap')){
var af=%GetWeakMapEntries(this.value_,ae||0);
for(var N=0;N<af.length;N+=2){
S.push({
key:af[N],
value:af[N+1]
});
}
return S;
}
var ag=%_Call(h,this.value_);
var ah;
while((!ae||S.length<ae)&&
!(ah=ag.next()).done){
S.push({
key:ah.value[0],
value:ah.value[1]
});
}
return S;
};
function SetMirror(v){
%_Call(ObjectMirror,this,v,q.SET_TYPE);
}
inherits(SetMirror,ObjectMirror);
function IteratorGetValues_(ag,ai,ae){
var S=[];
var ah;
while((!ae||S.length<ae)&&
!(ah=%_Call(ai,ag)).done){
S.push(ah.value);
}
return S;
}
SetMirror.prototype.values=function(ae){
if((%_ClassOf(this.value_)==='WeakSet')){
return %GetWeakSetValues(this.value_,ae||0);
}
var ag=%_Call(n,this.value_);
return IteratorGetValues_(ag,m,ae);
};
function IteratorMirror(v){
%_Call(ObjectMirror,this,v,q.ITERATOR_TYPE);
}
inherits(IteratorMirror,ObjectMirror);
IteratorMirror.prototype.preview=function(ae){
if((%_ClassOf(this.value_)==='Map Iterator')){
return IteratorGetValues_(%MapIteratorClone(this.value_),
i,
ae);
}else if((%_ClassOf(this.value_)==='Set Iterator')){
return IteratorGetValues_(%SetIteratorClone(this.value_),
m,
ae);
}
};
function GeneratorMirror(v){
%_Call(ObjectMirror,this,v,q.GENERATOR_TYPE);
}
inherits(GeneratorMirror,ObjectMirror);
function GeneratorGetStatus_(v){
var aj=%GeneratorGetContinuation(v);
if(aj<0)return"running";
if(aj==0)return"closed";
return"suspended";
}
GeneratorMirror.prototype.status=function(){
return GeneratorGetStatus_(this.value_);
};
GeneratorMirror.prototype.sourcePosition_=function(){
return %GeneratorGetSourcePosition(this.value_);
};
GeneratorMirror.prototype.sourceLocation=function(){
var ak=this.sourcePosition_();
if(!(ak===(void 0))){
var T=this.func().script();
if(T){
return T.locationFromPosition(ak,true);
}
}
};
GeneratorMirror.prototype.func=function(){
if(!this.func_){
this.func_=MakeMirror(%GeneratorGetFunction(this.value_));
}
return this.func_;
};
GeneratorMirror.prototype.context=function(){
if(!this.context_){
this.context_=new ContextMirror(%GeneratorGetContext(this.value_));
}
return this.context_;
};
GeneratorMirror.prototype.receiver=function(){
if(!this.receiver_){
this.receiver_=MakeMirror(%GeneratorGetReceiver(this.value_));
}
return this.receiver_;
};
function PropertyMirror(x,O,P){
%_Call(Mirror,this,q.PROPERTY_TYPE);
this.mirror_=x;
this.name_=O;
this.value_=P[0];
this.details_=P[1];
this.is_interceptor_=P[2];
if(P.length>3){
this.exception_=P[3];
this.getter_=P[4];
this.setter_=P[5];
}
}
inherits(PropertyMirror,Mirror);
PropertyMirror.prototype.isReadOnly=function(){
return(this.attributes()&F.ReadOnly)!=0;
};
PropertyMirror.prototype.isEnum=function(){
return(this.attributes()&F.DontEnum)==0;
};
PropertyMirror.prototype.canDelete=function(){
return(this.attributes()&F.DontDelete)==0;
};
PropertyMirror.prototype.name=function(){
return this.name_;
};
PropertyMirror.prototype.isIndexed=function(){
for(var N=0;N<this.name_.length;N++){
if(this.name_[N]<'0'||'9'<this.name_[N]){
return false;
}
}
return true;
};
PropertyMirror.prototype.value=function(){
return MakeMirror(this.value_,false);
};
PropertyMirror.prototype.isException=function(){
return this.exception_?true:false;
};
PropertyMirror.prototype.attributes=function(){
return %DebugPropertyAttributesFromDetails(this.details_);
};
PropertyMirror.prototype.propertyType=function(){
return %DebugPropertyTypeFromDetails(this.details_);
};
PropertyMirror.prototype.insertionIndex=function(){
return %DebugPropertyIndexFromDetails(this.details_);
};
PropertyMirror.prototype.hasGetter=function(){
return this.getter_?true:false;
};
PropertyMirror.prototype.hasSetter=function(){
return this.setter_?true:false;
};
PropertyMirror.prototype.getter=function(){
if(this.hasGetter()){
return MakeMirror(this.getter_);
}else{
return GetUndefinedMirror();
}
};
PropertyMirror.prototype.setter=function(){
if(this.hasSetter()){
return MakeMirror(this.setter_);
}else{
return GetUndefinedMirror();
}
};
PropertyMirror.prototype.isNative=function(){
return this.is_interceptor_||
((this.propertyType()==E.AccessorConstant)&&
!this.hasGetter()&&!this.hasSetter());
};
function InternalPropertyMirror(O,v){
%_Call(Mirror,this,q.INTERNAL_PROPERTY_TYPE);
this.name_=O;
this.value_=v;
}
inherits(InternalPropertyMirror,Mirror);
InternalPropertyMirror.prototype.name=function(){
return this.name_;
};
InternalPropertyMirror.prototype.value=function(){
return MakeMirror(this.value_,false);
};
var al=0;
var am=1;
var an=2;
var ao=3;
var ap=4;
var aq=5;
var ar=6;
var as=7;
var at=8;
var au=9;
var av=0;
var aw=1;
var ax=2;
var ay=1<<0;
var az=1<<1;
var aA=7<<2;
function FrameDetails(aB,V){
this.break_id_=aB;
this.details_=%GetFrameDetails(aB,V);
}
FrameDetails.prototype.frameId=function(){
%CheckExecutionState(this.break_id_);
return this.details_[al];
};
FrameDetails.prototype.receiver=function(){
%CheckExecutionState(this.break_id_);
return this.details_[am];
};
FrameDetails.prototype.func=function(){
%CheckExecutionState(this.break_id_);
return this.details_[an];
};
FrameDetails.prototype.isConstructCall=function(){
%CheckExecutionState(this.break_id_);
return this.details_[ar];
};
FrameDetails.prototype.isAtReturn=function(){
%CheckExecutionState(this.break_id_);
return this.details_[as];
};
FrameDetails.prototype.isDebuggerFrame=function(){
%CheckExecutionState(this.break_id_);
var aC=ay;
return(this.details_[at]&aC)==aC;
};
FrameDetails.prototype.isOptimizedFrame=function(){
%CheckExecutionState(this.break_id_);
var aC=az;
return(this.details_[at]&aC)==aC;
};
FrameDetails.prototype.isInlinedFrame=function(){
return this.inlinedFrameIndex()>0;
};
FrameDetails.prototype.inlinedFrameIndex=function(){
%CheckExecutionState(this.break_id_);
var aC=aA;
return(this.details_[at]&aC)>>2;
};
FrameDetails.prototype.argumentCount=function(){
%CheckExecutionState(this.break_id_);
return this.details_[ao];
};
FrameDetails.prototype.argumentName=function(V){
%CheckExecutionState(this.break_id_);
if(V>=0&&V<this.argumentCount()){
return this.details_[au+
V*ax+
av];
}
};
FrameDetails.prototype.argumentValue=function(V){
%CheckExecutionState(this.break_id_);
if(V>=0&&V<this.argumentCount()){
return this.details_[au+
V*ax+
aw];
}
};
FrameDetails.prototype.localCount=function(){
%CheckExecutionState(this.break_id_);
return this.details_[ap];
};
FrameDetails.prototype.sourcePosition=function(){
%CheckExecutionState(this.break_id_);
return this.details_[aq];
};
FrameDetails.prototype.localName=function(V){
%CheckExecutionState(this.break_id_);
if(V>=0&&V<this.localCount()){
var aD=au+
this.argumentCount()*ax;
return this.details_[aD+
V*ax+
av];
}
};
FrameDetails.prototype.localValue=function(V){
%CheckExecutionState(this.break_id_);
if(V>=0&&V<this.localCount()){
var aD=au+
this.argumentCount()*ax;
return this.details_[aD+
V*ax+
aw];
}
};
FrameDetails.prototype.returnValue=function(){
%CheckExecutionState(this.break_id_);
var aE=
au+
(this.argumentCount()+this.localCount())*ax;
if(this.details_[as]){
return this.details_[aE];
}
};
FrameDetails.prototype.scopeCount=function(){
if((this.scopeCount_===(void 0))){
this.scopeCount_=%GetScopeCount(this.break_id_,this.frameId());
}
return this.scopeCount_;
};
FrameDetails.prototype.stepInPositionsImpl=function(){
return %GetStepInPositions(this.break_id_,this.frameId());
};
function FrameMirror(aB,V){
%_Call(Mirror,this,q.FRAME_TYPE);
this.break_id_=aB;
this.index_=V;
this.details_=new FrameDetails(aB,V);
}
inherits(FrameMirror,Mirror);
FrameMirror.prototype.details=function(){
return this.details_;
};
FrameMirror.prototype.index=function(){
return this.index_;
};
FrameMirror.prototype.func=function(){
if(this.func_){
return this.func_;
}
var aC=this.details_.func();
if((%_IsFunction(aC))){
return this.func_=MakeMirror(aC);
}else{
return new UnresolvedFunctionMirror(aC);
}
};
FrameMirror.prototype.receiver=function(){
return MakeMirror(this.details_.receiver());
};
FrameMirror.prototype.isConstructCall=function(){
return this.details_.isConstructCall();
};
FrameMirror.prototype.isAtReturn=function(){
return this.details_.isAtReturn();
};
FrameMirror.prototype.isDebuggerFrame=function(){
return this.details_.isDebuggerFrame();
};
FrameMirror.prototype.isOptimizedFrame=function(){
return this.details_.isOptimizedFrame();
};
FrameMirror.prototype.isInlinedFrame=function(){
return this.details_.isInlinedFrame();
};
FrameMirror.prototype.inlinedFrameIndex=function(){
return this.details_.inlinedFrameIndex();
};
FrameMirror.prototype.argumentCount=function(){
return this.details_.argumentCount();
};
FrameMirror.prototype.argumentName=function(V){
return this.details_.argumentName(V);
};
FrameMirror.prototype.argumentValue=function(V){
return MakeMirror(this.details_.argumentValue(V));
};
FrameMirror.prototype.localCount=function(){
return this.details_.localCount();
};
FrameMirror.prototype.localName=function(V){
return this.details_.localName(V);
};
FrameMirror.prototype.localValue=function(V){
return MakeMirror(this.details_.localValue(V));
};
FrameMirror.prototype.returnValue=function(){
return MakeMirror(this.details_.returnValue());
};
FrameMirror.prototype.sourcePosition=function(){
return this.details_.sourcePosition();
};
FrameMirror.prototype.sourceLocation=function(){
var aF=this.func();
if(aF.resolved()){
var T=aF.script();
if(T){
return T.locationFromPosition(this.sourcePosition(),true);
}
}
};
FrameMirror.prototype.sourceLine=function(){
var aG=this.sourceLocation();
if(aG){
return aG.line;
}
};
FrameMirror.prototype.sourceColumn=function(){
var aG=this.sourceLocation();
if(aG){
return aG.column;
}
};
FrameMirror.prototype.sourceLineText=function(){
var aG=this.sourceLocation();
if(aG){
return aG.sourceText();
}
};
FrameMirror.prototype.scopeCount=function(){
return this.details_.scopeCount();
};
FrameMirror.prototype.scope=function(V){
return new ScopeMirror(this,(void 0),V);
};
FrameMirror.prototype.allScopes=function(aH){
var aI=%GetAllScopesDetails(this.break_id_,
this.details_.frameId(),
this.details_.inlinedFrameIndex(),
!!aH);
var S=[];
for(var N=0;N<aI.length;++N){
S.push(new ScopeMirror(this,(void 0),N,aI[N]));
}
return S;
};
FrameMirror.prototype.stepInPositions=function(){
var T=this.func().script();
var aJ=this.func().sourcePosition_();
var aK=this.details_.stepInPositionsImpl();
var S=[];
if(aK){
for(var N=0;N<aK.length;N++){
var aL={};
var aM=T.locationFromPosition(aJ+aK[N],
true);
serializeLocationFields(aM,aL);
var aN={
position:aL
};
S.push(aN);
}
}
return S;
};
FrameMirror.prototype.evaluate=function(source,disable_break,
opt_context_object){
return MakeMirror(%DebugEvaluate(this.break_id_,
this.details_.frameId(),
this.details_.inlinedFrameIndex(),
source,
(!!(disable_break)),
opt_context_object));
};
FrameMirror.prototype.invocationText=function(){
var S='';
var aF=this.func();
var aO=this.receiver();
if(this.isConstructCall()){
S+='new ';
S+=aF.name()?aF.name():'[anonymous]';
}else if(this.isDebuggerFrame()){
S+='[debugger]';
}else{
var aP=
!aO.className||(aO.className()!='global');
if(aP){
S+=aO.toText();
}
var Q=GetUndefinedMirror();
if(aO.isObject()){
for(var aQ=aO;
!aQ.isNull()&&Q.isUndefined();
aQ=aQ.protoObject()){
Q=aQ.lookupProperty(aF);
}
}
if(!Q.isUndefined()){
if(!Q.isIndexed()){
if(aP){
S+='.';
}
S+=Q.name();
}else{
S+='[';
S+=Q.name();
S+=']';
}
if(aF.name()&&aF.name()!=Q.name()){
S+='(aka '+aF.name()+')';
}
}else{
if(aP){
S+='.';
}
S+=aF.name()?aF.name():'[anonymous]';
}
}
if(!this.isDebuggerFrame()){
S+='(';
for(var N=0;N<this.argumentCount();N++){
if(N!=0)S+=', ';
if(this.argumentName(N)){
S+=this.argumentName(N);
S+='=';
}
S+=this.argumentValue(N).toText();
}
S+=')';
}
if(this.isAtReturn()){
S+=' returning ';
S+=this.returnValue().toText();
}
return S;
};
FrameMirror.prototype.sourceAndPositionText=function(){
var S='';
var aF=this.func();
if(aF.resolved()){
var T=aF.script();
if(T){
if(T.name()){
S+=T.name();
}else{
S+='[unnamed]';
}
if(!this.isDebuggerFrame()){
var aG=this.sourceLocation();
S+=' line ';
S+=!(aG===(void 0))?(aG.line+1):'?';
S+=' column ';
S+=!(aG===(void 0))?(aG.column+1):'?';
if(!(this.sourcePosition()===(void 0))){
S+=' (position '+(this.sourcePosition()+1)+')';
}
}
}else{
S+='[no source]';
}
}else{
S+='[unresolved]';
}
return S;
};
FrameMirror.prototype.localsText=function(){
var S='';
var aR=this.localCount();
if(aR>0){
for(var N=0;N<aR;++N){
S+='      var ';
S+=this.localName(N);
S+=' = ';
S+=this.localValue(N).toText();
if(N<aR-1)S+='\n';
}
}
return S;
};
FrameMirror.prototype.restart=function(){
var S=%LiveEditRestartFrame(this.break_id_,this.index_);
if((S===(void 0))){
S="Failed to find requested frame";
}
return S;
};
FrameMirror.prototype.toText=function(aS){
var S='';
S+='#'+(this.index()<=9?'0':'')+this.index();
S+=' ';
S+=this.invocationText();
S+=' ';
S+=this.sourceAndPositionText();
if(aS){
S+='\n';
S+=this.localsText();
}
return S;
};
var aT=0;
var aU=1;
var aV=2;
function ScopeDetails(aW,aX,V,aY){
if(aW){
this.break_id_=aW.break_id_;
this.details_=aY||
%GetScopeDetails(aW.break_id_,
aW.details_.frameId(),
aW.details_.inlinedFrameIndex(),
V);
this.frame_id_=aW.details_.frameId();
this.inlined_frame_id_=aW.details_.inlinedFrameIndex();
}else{
this.details_=aY||%GetFunctionScopeDetails(aX.value(),V);
this.fun_value_=aX.value();
this.break_id_=(void 0);
}
this.index_=V;
}
ScopeDetails.prototype.type=function(){
if(!(this.break_id_===(void 0))){
%CheckExecutionState(this.break_id_);
}
return this.details_[aT];
};
ScopeDetails.prototype.object=function(){
if(!(this.break_id_===(void 0))){
%CheckExecutionState(this.break_id_);
}
return this.details_[aU];
};
ScopeDetails.prototype.name=function(){
if(!(this.break_id_===(void 0))){
%CheckExecutionState(this.break_id_);
}
return this.details_[aV];
};
ScopeDetails.prototype.setVariableValueImpl=function(O,aZ){
var ba;
if(!(this.break_id_===(void 0))){
%CheckExecutionState(this.break_id_);
ba=%SetScopeVariableValue(this.break_id_,this.frame_id_,
this.inlined_frame_id_,this.index_,O,aZ);
}else{
ba=%SetScopeVariableValue(this.fun_value_,null,null,this.index_,
O,aZ);
}
if(!ba)throw g(2,"Failed to set variable value");
};
function ScopeMirror(aW,aX,V,aY){
%_Call(Mirror,this,q.SCOPE_TYPE);
if(aW){
this.frame_index_=aW.index_;
}else{
this.frame_index_=(void 0);
}
this.scope_index_=V;
this.details_=new ScopeDetails(aW,aX,V,aY);
}
inherits(ScopeMirror,Mirror);
ScopeMirror.prototype.details=function(){
return this.details_;
};
ScopeMirror.prototype.frameIndex=function(){
return this.frame_index_;
};
ScopeMirror.prototype.scopeIndex=function(){
return this.scope_index_;
};
ScopeMirror.prototype.scopeType=function(){
return this.details_.type();
};
ScopeMirror.prototype.scopeObject=function(){
var I=this.scopeType()==G.Local||
this.scopeType()==G.Closure||
this.scopeType()==G.Script;
return MakeMirror(this.details_.object(),I);
};
ScopeMirror.prototype.setVariableValue=function(O,aZ){
this.details_.setVariableValueImpl(O,aZ);
};
function ScriptMirror(T){
%_Call(Mirror,this,q.SCRIPT_TYPE);
this.script_=T;
this.context_=new ContextMirror(T.context_data);
this.allocateHandle_();
}
inherits(ScriptMirror,Mirror);
ScriptMirror.prototype.value=function(){
return this.script_;
};
ScriptMirror.prototype.name=function(){
return this.script_.name||this.script_.nameOrSourceURL();
};
ScriptMirror.prototype.id=function(){
return this.script_.id;
};
ScriptMirror.prototype.source=function(){
return this.script_.source;
};
ScriptMirror.prototype.setSource=function(bb){
%DebugSetScriptSource(this.script_,bb);
};
ScriptMirror.prototype.lineOffset=function(){
return this.script_.line_offset;
};
ScriptMirror.prototype.columnOffset=function(){
return this.script_.column_offset;
};
ScriptMirror.prototype.data=function(){
return this.script_.data;
};
ScriptMirror.prototype.scriptType=function(){
return this.script_.type;
};
ScriptMirror.prototype.compilationType=function(){
return this.script_.compilation_type;
};
ScriptMirror.prototype.lineCount=function(){
return this.script_.lineCount();
};
ScriptMirror.prototype.locationFromPosition=function(
position,include_resource_offset){
return this.script_.locationFromPosition(position,include_resource_offset);
};
ScriptMirror.prototype.sourceSlice=function(bc,bd){
return this.script_.sourceSlice(bc,bd);
};
ScriptMirror.prototype.context=function(){
return this.context_;
};
ScriptMirror.prototype.evalFromScript=function(){
return MakeMirror(this.script_.eval_from_script);
};
ScriptMirror.prototype.evalFromFunctionName=function(){
return MakeMirror(this.script_.eval_from_function_name);
};
ScriptMirror.prototype.evalFromLocation=function(){
var be=this.evalFromScript();
if(!be.isUndefined()){
var bf=this.script_.eval_from_script_position;
return be.locationFromPosition(bf,true);
}
};
ScriptMirror.prototype.toText=function(){
var S='';
S+=this.name();
S+=' (lines: ';
if(this.lineOffset()>0){
S+=this.lineOffset();
S+='-';
S+=this.lineOffset()+this.lineCount()-1;
}else{
S+=this.lineCount();
}
S+=')';
return S;
};
function ContextMirror(bg){
%_Call(Mirror,this,q.CONTEXT_TYPE);
this.data_=bg;
this.allocateHandle_();
}
inherits(ContextMirror,Mirror);
ContextMirror.prototype.data=function(){
return this.data_;
};
function MakeMirrorSerializer(P,bh){
return new JSONProtocolSerializer(P,bh);
}
function JSONProtocolSerializer(P,bh){
this.details_=P;
this.options_=bh;
this.mirrors_=[];
}
JSONProtocolSerializer.prototype.serializeReference=function(x){
return this.serialize_(x,true,true);
};
JSONProtocolSerializer.prototype.serializeValue=function(x){
var bi=this.serialize_(x,false,true);
return bi;
};
JSONProtocolSerializer.prototype.serializeReferencedObjects=function(){
var bj=[];
var bk=this.mirrors_.length;
for(var N=0;N<bk;N++){
bj.push(this.serialize_(this.mirrors_[N],false,false));
}
return bj;
};
JSONProtocolSerializer.prototype.includeSource_=function(){
return this.options_&&this.options_.includeSource;
};
JSONProtocolSerializer.prototype.inlineRefs_=function(){
return this.options_&&this.options_.inlineRefs;
};
JSONProtocolSerializer.prototype.maxStringLength_=function(){
if((this.options_===(void 0))||
(this.options_.maxStringLength===(void 0))){
return D;
}
return this.options_.maxStringLength;
};
JSONProtocolSerializer.prototype.add_=function(x){
for(var N=0;N<this.mirrors_.length;N++){
if(this.mirrors_[N]===x){
return;
}
}
this.mirrors_.push(x);
};
JSONProtocolSerializer.prototype.serializeReferenceWithDisplayData_=
function(x){
var bl={};
bl.ref=x.handle();
bl.type=x.type();
switch(x.type()){
case q.UNDEFINED_TYPE:
case q.NULL_TYPE:
case q.BOOLEAN_TYPE:
case q.NUMBER_TYPE:
bl.value=x.value();
break;
case q.STRING_TYPE:
bl.value=x.getTruncatedValue(this.maxStringLength_());
break;
case q.SYMBOL_TYPE:
bl.description=x.description();
break;
case q.FUNCTION_TYPE:
bl.name=x.name();
bl.inferredName=x.inferredName();
if(x.script()){
bl.scriptId=x.script().id();
}
break;
case q.ERROR_TYPE:
case q.REGEXP_TYPE:
bl.value=x.toText();
break;
case q.OBJECT_TYPE:
bl.className=x.className();
break;
}
return bl;
};
JSONProtocolSerializer.prototype.serialize_=function(x,reference,
P){
if(reference&&
(x.isValue()||x.isScript()||x.isContext())){
if(this.inlineRefs_()&&x.isValue()){
return this.serializeReferenceWithDisplayData_(x);
}else{
this.add_(x);
return{'ref':x.handle()};
}
}
var bj={};
if(x.isValue()||x.isScript()||x.isContext()){
bj.handle=x.handle();
}
bj.type=x.type();
switch(x.type()){
case q.UNDEFINED_TYPE:
case q.NULL_TYPE:
break;
case q.BOOLEAN_TYPE:
bj.value=x.value();
break;
case q.NUMBER_TYPE:
bj.value=NumberToJSON_(x.value());
break;
case q.STRING_TYPE:
if(this.maxStringLength_()!=-1&&
x.length()>this.maxStringLength_()){
var bm=x.getTruncatedValue(this.maxStringLength_());
bj.value=bm;
bj.fromIndex=0;
bj.toIndex=this.maxStringLength_();
}else{
bj.value=x.value();
}
bj.length=x.length();
break;
case q.SYMBOL_TYPE:
bj.description=x.description();
break;
case q.OBJECT_TYPE:
case q.FUNCTION_TYPE:
case q.ERROR_TYPE:
case q.REGEXP_TYPE:
case q.PROMISE_TYPE:
case q.GENERATOR_TYPE:
this.serializeObject_(x,bj,P);
break;
case q.PROPERTY_TYPE:
case q.INTERNAL_PROPERTY_TYPE:
throw g(2,
'PropertyMirror cannot be serialized independently');
break;
case q.FRAME_TYPE:
this.serializeFrame_(x,bj);
break;
case q.SCOPE_TYPE:
this.serializeScope_(x,bj);
break;
case q.SCRIPT_TYPE:
if(x.name()){
bj.name=x.name();
}
bj.id=x.id();
bj.lineOffset=x.lineOffset();
bj.columnOffset=x.columnOffset();
bj.lineCount=x.lineCount();
if(x.data()){
bj.data=x.data();
}
if(this.includeSource_()){
bj.source=x.source();
}else{
var bn=x.source().substring(0,80);
bj.sourceStart=bn;
}
bj.sourceLength=x.source().length;
bj.scriptType=x.scriptType();
bj.compilationType=x.compilationType();
if(x.compilationType()==1&&
x.evalFromScript()){
bj.evalFromScript=
this.serializeReference(x.evalFromScript());
var bo=x.evalFromLocation();
if(bo){
bj.evalFromLocation={line:bo.line,
column:bo.column};
}
if(x.evalFromFunctionName()){
bj.evalFromFunctionName=x.evalFromFunctionName();
}
}
if(x.context()){
bj.context=this.serializeReference(x.context());
}
break;
case q.CONTEXT_TYPE:
bj.data=x.data();
break;
}
bj.text=x.toText();
return bj;
};
JSONProtocolSerializer.prototype.serializeObject_=function(x,bj,
P){
bj.className=x.className();
bj.constructorFunction=
this.serializeReference(x.constructorFunction());
bj.protoObject=this.serializeReference(x.protoObject());
bj.prototypeObject=this.serializeReference(x.prototypeObject());
if(x.hasNamedInterceptor()){
bj.namedInterceptor=true;
}
if(x.hasIndexedInterceptor()){
bj.indexedInterceptor=true;
}
if(x.isFunction()){
bj.name=x.name();
if(!(x.inferredName()===(void 0))){
bj.inferredName=x.inferredName();
}
bj.resolved=x.resolved();
if(x.resolved()){
bj.source=x.source();
}
if(x.script()){
bj.script=this.serializeReference(x.script());
bj.scriptId=x.script().id();
serializeLocationFields(x.sourceLocation(),bj);
}
bj.scopes=[];
for(var N=0;N<x.scopeCount();N++){
var bp=x.scope(N);
bj.scopes.push({
type:bp.scopeType(),
index:N
});
}
}
if(x.isGenerator()){
bj.status=x.status();
bj.func=this.serializeReference(x.func())
bj.receiver=this.serializeReference(x.receiver())
serializeLocationFields(x.sourceLocation(),bj);
}
if(x.isDate()){
bj.value=x.value();
}
if(x.isPromise()){
bj.status=x.status();
bj.promiseValue=this.serializeReference(x.promiseValue());
}
var M=x.propertyNames();
for(var N=0;N<M.length;N++){
var bq=x.property(M[N]);
M[N]=this.serializeProperty_(bq);
if(P){
this.add_(bq.value());
}
}
bj.properties=M;
var br=x.internalProperties();
if(br.length>0){
var bs=[];
for(var N=0;N<br.length;N++){
bs.push(this.serializeInternalProperty_(br[N]));
}
bj.internalProperties=bs;
}
};
function serializeLocationFields(aG,bj){
if(!aG){
return;
}
bj.position=aG.position;
var bt=aG.line;
if(!(bt===(void 0))){
bj.line=bt;
}
var bu=aG.column;
if(!(bu===(void 0))){
bj.column=bu;
}
}
JSONProtocolSerializer.prototype.serializeProperty_=function(bq){
var S={};
S.name=bq.name();
var bv=bq.value();
if(this.inlineRefs_()&&bv.isValue()){
S.value=this.serializeReferenceWithDisplayData_(bv);
}else{
if(bq.attributes()!=F.None){
S.attributes=bq.attributes();
}
S.propertyType=bq.propertyType();
S.ref=bv.handle();
}
return S;
};
JSONProtocolSerializer.prototype.serializeInternalProperty_=
function(bq){
var S={};
S.name=bq.name();
var bv=bq.value();
if(this.inlineRefs_()&&bv.isValue()){
S.value=this.serializeReferenceWithDisplayData_(bv);
}else{
S.ref=bv.handle();
}
return S;
};
JSONProtocolSerializer.prototype.serializeFrame_=function(x,bj){
bj.index=x.index();
bj.receiver=this.serializeReference(x.receiver());
var aF=x.func();
bj.func=this.serializeReference(aF);
var T=aF.script();
if(T){
bj.script=this.serializeReference(T);
}
bj.constructCall=x.isConstructCall();
bj.atReturn=x.isAtReturn();
if(x.isAtReturn()){
bj.returnValue=this.serializeReference(x.returnValue());
}
bj.debuggerFrame=x.isDebuggerFrame();
var K=new d(x.argumentCount());
for(var N=0;N<x.argumentCount();N++){
var bw={};
var bx=x.argumentName(N);
if(bx){
bw.name=bx;
}
bw.value=this.serializeReference(x.argumentValue(N));
K[N]=bw;
}
bj.arguments=K;
var K=new d(x.localCount());
for(var N=0;N<x.localCount();N++){
var by={};
by.name=x.localName(N);
by.value=this.serializeReference(x.localValue(N));
K[N]=by;
}
bj.locals=K;
serializeLocationFields(x.sourceLocation(),bj);
var bz=x.sourceLineText();
if(!(bz===(void 0))){
bj.sourceLineText=bz;
}
bj.scopes=[];
for(var N=0;N<x.scopeCount();N++){
var bp=x.scope(N);
bj.scopes.push({
type:bp.scopeType(),
index:N
});
}
};
JSONProtocolSerializer.prototype.serializeScope_=function(x,bj){
bj.index=x.scopeIndex();
bj.frameIndex=x.frameIndex();
bj.type=x.scopeType();
bj.object=this.inlineRefs_()?
this.serializeValue(x.scopeObject()):
this.serializeReference(x.scopeObject());
};
function NumberToJSON_(v){
if(e(v)){
return'NaN';
}
if(!(%_IsSmi(%IS_VAR(v))||((v==v)&&(v!=1/0)&&(v!=-1/0)))){
if(v>0){
return'Infinity';
}else{
return'-Infinity';
}
}
return v;
}
b.InstallFunctions(a,2,[
"MakeMirror",MakeMirror,
"MakeMirrorSerializer",MakeMirrorSerializer,
"LookupMirror",LookupMirror,
"ToggleMirrorCache",ToggleMirrorCache,
"MirrorCacheIsEmpty",MirrorCacheIsEmpty,
]);
b.InstallConstants(a,[
"ScopeType",G,
"PropertyType",E,
"PropertyAttribute",F,
"Mirror",Mirror,
"ValueMirror",ValueMirror,
"UndefinedMirror",UndefinedMirror,
"NullMirror",NullMirror,
"BooleanMirror",BooleanMirror,
"NumberMirror",NumberMirror,
"StringMirror",StringMirror,
"SymbolMirror",SymbolMirror,
"ObjectMirror",ObjectMirror,
"FunctionMirror",FunctionMirror,
"UnresolvedFunctionMirror",UnresolvedFunctionMirror,
"ArrayMirror",ArrayMirror,
"DateMirror",DateMirror,
"RegExpMirror",RegExpMirror,
"ErrorMirror",ErrorMirror,
"PromiseMirror",PromiseMirror,
"MapMirror",MapMirror,
"SetMirror",SetMirror,
"IteratorMirror",IteratorMirror,
"GeneratorMirror",GeneratorMirror,
"PropertyMirror",PropertyMirror,
"InternalPropertyMirror",InternalPropertyMirror,
"FrameMirror",FrameMirror,
"ScriptMirror",ScriptMirror,
"ScopeMirror",ScopeMirror,
"FrameDetails",FrameDetails,
]);
b.InstallFunctions(b,2,[
"ClearMirrorCache",ClearMirrorCache
]);
b.Export(function(bA){
bA.MirrorType=q;
});
})

debugNƒ
(function(a,b){
"use strict";
var c=a.FrameMirror;
var d=a.Array;
var e=a.RegExp;
var f=a.isNaN;
var g=a.JSON.parse;
var h=a.JSON.stringify;
var i=a.LookupMirror;
var j;
var k;
var l=a.MakeMirror;
var m=a.MakeMirrorSerializer;
var n=a.Math.min;
var o=a.Mirror;
var p;
var q=a.parseInt;
var r=a.ValueMirror;
b.Import(function(s){
j=s.MakeError;
k=s.MakeTypeError;
p=s.MirrorType;
});
var t=10;
var u={};
var v=/^(?:\s*(?:\/\*.*?\*\/)*)*/;
u.DebugEvent={Break:1,
Exception:2,
NewFunction:3,
BeforeCompile:4,
AfterCompile:5,
CompileError:6,
PromiseEvent:7,
AsyncTaskEvent:8};
u.ExceptionBreak={Caught:0,
Uncaught:1};
u.StepAction={StepOut:0,
StepNext:1,
StepIn:2,
StepFrame:3};
u.ScriptType={Native:0,
Extension:1,
Normal:2};
u.ScriptCompilationType={Host:0,
Eval:1,
JSON:2};
u.ScriptBreakPointType={ScriptId:0,
ScriptName:1,
ScriptRegExp:2};
u.BreakPositionAlignment={
Statement:0,
BreakPosition:1
};
function ScriptTypeFlag(w){
return(1<<w);
}
var x=0;
var y=1;
var z=[];
var A=[];
var B={
breakPointsActive:{
value:true,
getValue:function(){return this.value;},
setValue:function(C){
this.value=!!C;
%SetBreakPointsActive(this.value);
}
},
breakOnCaughtException:{
getValue:function(){return u.isBreakOnException();},
setValue:function(C){
if(C){
u.setBreakOnException();
}else{
u.clearBreakOnException();
}
}
},
breakOnUncaughtException:{
getValue:function(){return u.isBreakOnUncaughtException();},
setValue:function(C){
if(C){
u.setBreakOnUncaughtException();
}else{
u.clearBreakOnUncaughtException();
}
}
},
};
function MakeBreakPoint(D,E){
var F=new BreakPoint(D,E);
z.push(F);
return F;
}
function BreakPoint(D,E){
this.source_position_=D;
if(E){
this.script_break_point_=E;
}else{
this.number_=y++;
}
this.hit_count_=0;
this.active_=true;
this.condition_=null;
this.ignoreCount_=0;
}
BreakPoint.prototype.number=function(){
return this.number_;
};
BreakPoint.prototype.func=function(){
return this.func_;
};
BreakPoint.prototype.source_position=function(){
return this.source_position_;
};
BreakPoint.prototype.hit_count=function(){
return this.hit_count_;
};
BreakPoint.prototype.active=function(){
if(this.script_break_point()){
return this.script_break_point().active();
}
return this.active_;
};
BreakPoint.prototype.condition=function(){
if(this.script_break_point()&&this.script_break_point().condition()){
return this.script_break_point().condition();
}
return this.condition_;
};
BreakPoint.prototype.ignoreCount=function(){
return this.ignoreCount_;
};
BreakPoint.prototype.script_break_point=function(){
return this.script_break_point_;
};
BreakPoint.prototype.enable=function(){
this.active_=true;
};
BreakPoint.prototype.disable=function(){
this.active_=false;
};
BreakPoint.prototype.setCondition=function(G){
this.condition_=G;
};
BreakPoint.prototype.setIgnoreCount=function(H){
this.ignoreCount_=H;
};
BreakPoint.prototype.isTriggered=function(I){
if(!this.active())return false;
if(this.condition()){
try{
var J=I.frame(0).evaluate(this.condition());
if(!(J instanceof r)||!J.value_){
return false;
}
}catch(e){
return false;
}
}
this.hit_count_++;
if(this.script_break_point_){
this.script_break_point_.hit_count_++;
}
if(this.ignoreCount_>0){
this.ignoreCount_--;
return false;
}
return true;
};
function IsBreakPointTriggered(K,F){
return F.isTriggered(MakeExecutionState(K));
}
function ScriptBreakPoint(w,script_id_or_name,opt_line,opt_column,
opt_groupId,opt_position_alignment){
this.type_=w;
if(w==u.ScriptBreakPointType.ScriptId){
this.script_id_=script_id_or_name;
}else if(w==u.ScriptBreakPointType.ScriptName){
this.script_name_=script_id_or_name;
}else if(w==u.ScriptBreakPointType.ScriptRegExp){
this.script_regexp_object_=new e(script_id_or_name);
}else{
throw j(2,"Unexpected breakpoint type "+w);
}
this.line_=opt_line||0;
this.column_=opt_column;
this.groupId_=opt_groupId;
this.position_alignment_=(opt_position_alignment===(void 0))
?u.BreakPositionAlignment.Statement:opt_position_alignment;
this.hit_count_=0;
this.active_=true;
this.condition_=null;
this.ignoreCount_=0;
this.break_points_=[];
}
ScriptBreakPoint.prototype.cloneForOtherScript=function(L){
var M=new ScriptBreakPoint(u.ScriptBreakPointType.ScriptId,
L.id,this.line_,this.column_,this.groupId_,
this.position_alignment_);
M.number_=y++;
A.push(M);
M.hit_count_=this.hit_count_;
M.active_=this.active_;
M.condition_=this.condition_;
M.ignoreCount_=this.ignoreCount_;
return M;
};
ScriptBreakPoint.prototype.number=function(){
return this.number_;
};
ScriptBreakPoint.prototype.groupId=function(){
return this.groupId_;
};
ScriptBreakPoint.prototype.type=function(){
return this.type_;
};
ScriptBreakPoint.prototype.script_id=function(){
return this.script_id_;
};
ScriptBreakPoint.prototype.script_name=function(){
return this.script_name_;
};
ScriptBreakPoint.prototype.script_regexp_object=function(){
return this.script_regexp_object_;
};
ScriptBreakPoint.prototype.line=function(){
return this.line_;
};
ScriptBreakPoint.prototype.column=function(){
return this.column_;
};
ScriptBreakPoint.prototype.actual_locations=function(){
var N=[];
for(var O=0;O<this.break_points_.length;O++){
N.push(this.break_points_[O].actual_location);
}
return N;
};
ScriptBreakPoint.prototype.update_positions=function(P,Q){
this.line_=P;
this.column_=Q;
};
ScriptBreakPoint.prototype.hit_count=function(){
return this.hit_count_;
};
ScriptBreakPoint.prototype.active=function(){
return this.active_;
};
ScriptBreakPoint.prototype.condition=function(){
return this.condition_;
};
ScriptBreakPoint.prototype.ignoreCount=function(){
return this.ignoreCount_;
};
ScriptBreakPoint.prototype.enable=function(){
this.active_=true;
};
ScriptBreakPoint.prototype.disable=function(){
this.active_=false;
};
ScriptBreakPoint.prototype.setCondition=function(G){
this.condition_=G;
};
ScriptBreakPoint.prototype.setIgnoreCount=function(H){
this.ignoreCount_=H;
for(var O=0;O<this.break_points_.length;O++){
this.break_points_[O].setIgnoreCount(H);
}
};
ScriptBreakPoint.prototype.matchesScript=function(R){
if(this.type_==u.ScriptBreakPointType.ScriptId){
return this.script_id_==R.id;
}else{
if(!(R.line_offset<=this.line_&&
this.line_<R.line_offset+R.lineCount())){
return false;
}
if(this.type_==u.ScriptBreakPointType.ScriptName){
return this.script_name_==R.nameOrSourceURL();
}else if(this.type_==u.ScriptBreakPointType.ScriptRegExp){
return this.script_regexp_object_.test(R.nameOrSourceURL());
}else{
throw j(2,"Unexpected breakpoint type "+this.type_);
}
}
};
ScriptBreakPoint.prototype.set=function(R){
var Q=this.column();
var P=this.line();
if((Q===(void 0))){
var S=R.sourceLine(this.line());
if(!R.sourceColumnStart_){
R.sourceColumnStart_=new d(R.lineCount());
}
if((R.sourceColumnStart_[P]===(void 0))){
R.sourceColumnStart_[P]=
S.match(v)[0].length;
}
Q=R.sourceColumnStart_[P];
}
var T=u.findScriptSourcePosition(R,this.line(),Q);
if((T===null))return;
var F=MakeBreakPoint(T,this);
F.setIgnoreCount(this.ignoreCount());
var U=%SetScriptBreakPoint(R,T,
this.position_alignment_,
F);
if((U===(void 0))){
U=T;
}
var V=R.locationFromPosition(U,true);
F.actual_location={line:V.line,
column:V.column,
script_id:R.id};
this.break_points_.push(F);
return F;
};
ScriptBreakPoint.prototype.clear=function(){
var W=[];
for(var O=0;O<z.length;O++){
if(z[O].script_break_point()&&
z[O].script_break_point()===this){
%ClearBreakPoint(z[O]);
}else{
W.push(z[O]);
}
}
z=W;
this.break_points_=[];
};
function UpdateScriptBreakPoints(R){
for(var O=0;O<A.length;O++){
var F=A[O];
if((F.type()==u.ScriptBreakPointType.ScriptName||
F.type()==u.ScriptBreakPointType.ScriptRegExp)&&
F.matchesScript(R)){
F.set(R);
}
}
}
function GetScriptBreakPoints(R){
var X=[];
for(var O=0;O<A.length;O++){
if(A[O].matchesScript(R)){
X.push(A[O]);
}
}
return X;
}
u.setListener=function(Y,Z){
if(!(%_IsFunction(Y))&&!(Y===(void 0))&&!(Y===null)){
throw k(32);
}
%SetDebugEventListener(Y,Z);
};
u.breakLocations=function(aa,ab){
if(!(%_IsFunction(aa)))throw k(32);
var ac=(ab===(void 0))
?u.BreakPositionAlignment.Statement:ab;
return %GetBreakLocations(aa,ac);
};
u.findScript=function(ad){
if((%_IsFunction(ad))){
return %FunctionGetScript(ad);
}else if((%_IsRegExp(ad))){
var ae=u.scripts();
var af=null;
var ag=0;
for(var O in ae){
var R=ae[O];
if(ad.test(R.name)){
af=R;
ag++;
}
}
if(ag==1){
return af;
}else{
return(void 0);
}
}else{
return %GetScript(ad);
}
};
u.scriptSource=function(ad){
return this.findScript(ad).source;
};
u.source=function(aa){
if(!(%_IsFunction(aa)))throw k(32);
return %FunctionGetSourceCode(aa);
};
u.sourcePosition=function(aa){
if(!(%_IsFunction(aa)))throw k(32);
return %FunctionGetScriptSourcePosition(aa);
};
u.findFunctionSourceLocation=function(ah,ai,aj){
var R=%FunctionGetScript(ah);
var ak=%FunctionGetScriptSourcePosition(ah);
return R.locationFromLine(ai,aj,ak);
};
u.findScriptSourcePosition=function(R,ai,aj){
var al=R.locationFromLine(ai,aj);
return al?al.position:null;
};
u.findBreakPoint=function(am,an){
var F;
for(var O=0;O<z.length;O++){
if(z[O].number()==am){
F=z[O];
if(an){
z.splice(O,1);
}
break;
}
}
if(F){
return F;
}else{
return this.findScriptBreakPoint(am,an);
}
};
u.findBreakPointActualLocations=function(am){
for(var O=0;O<A.length;O++){
if(A[O].number()==am){
return A[O].actual_locations();
}
}
for(var O=0;O<z.length;O++){
if(z[O].number()==am){
return[z[O].actual_location];
}
}
return[];
};
u.setBreakPoint=function(ah,ai,aj,ao){
if(!(%_IsFunction(ah)))throw k(32);
if(%FunctionIsAPIFunction(ah)){
throw j(2,'Cannot set break point in native code.');
}
var ap=
this.findFunctionSourceLocation(ah,ai,aj).position;
var D=ap-this.sourcePosition(ah);
var R=%FunctionGetScript(ah);
if(R.type==u.ScriptType.Native){
throw j(2,'Cannot set break point in native code.');
}
if(R&&R.id){
D+=%FunctionGetScriptSourcePosition(ah);
var al=R.locationFromPosition(D,false);
return this.setScriptBreakPointById(R.id,
al.line,al.column,
ao);
}else{
var F=MakeBreakPoint(D);
var U=
%SetFunctionBreakPoint(ah,D,F);
U+=this.sourcePosition(ah);
var V=R.locationFromPosition(U,true);
F.actual_location={line:V.line,
column:V.column,
script_id:R.id};
F.setCondition(ao);
return F.number();
}
};
u.setBreakPointByScriptIdAndPosition=function(script_id,T,
G,enabled,
opt_position_alignment)
{
var F=MakeBreakPoint(T);
F.setCondition(G);
if(!enabled){
F.disable();
}
var ae=this.scripts();
var aq=(opt_position_alignment===(void 0))
?u.BreakPositionAlignment.Statement:opt_position_alignment;
for(var O=0;O<ae.length;O++){
if(script_id==ae[O].id){
F.actual_position=%SetScriptBreakPoint(ae[O],T,
aq,F);
break;
}
}
return F;
};
u.enableBreakPoint=function(am){
var F=this.findBreakPoint(am,false);
if(F){
F.enable();
}
};
u.disableBreakPoint=function(am){
var F=this.findBreakPoint(am,false);
if(F){
F.disable();
}
};
u.changeBreakPointCondition=function(am,G){
var F=this.findBreakPoint(am,false);
F.setCondition(G);
};
u.changeBreakPointIgnoreCount=function(am,H){
if(H<0)throw j(2,'Invalid argument');
var F=this.findBreakPoint(am,false);
F.setIgnoreCount(H);
};
u.clearBreakPoint=function(am){
var F=this.findBreakPoint(am,true);
if(F){
return %ClearBreakPoint(F);
}else{
F=this.findScriptBreakPoint(am,true);
if(!F)throw j(2,'Invalid breakpoint');
}
};
u.clearAllBreakPoints=function(){
for(var O=0;O<z.length;O++){
var F=z[O];
%ClearBreakPoint(F);
}
z=[];
};
u.disableAllBreakPoints=function(){
for(var O=1;O<y;O++){
u.disableBreakPoint(O);
}
%ChangeBreakOnException(u.ExceptionBreak.Caught,false);
%ChangeBreakOnException(u.ExceptionBreak.Uncaught,false);
};
u.findScriptBreakPoint=function(am,an){
var ar;
for(var O=0;O<A.length;O++){
if(A[O].number()==am){
ar=A[O];
if(an){
ar.clear();
A.splice(O,1);
}
break;
}
}
return ar;
};
u.setScriptBreakPoint=function(w,script_id_or_name,
ai,aj,ao,
opt_groupId,opt_position_alignment){
var ar=
new ScriptBreakPoint(w,script_id_or_name,ai,aj,
opt_groupId,opt_position_alignment);
ar.number_=y++;
ar.setCondition(ao);
A.push(ar);
var ae=this.scripts();
for(var O=0;O<ae.length;O++){
if(ar.matchesScript(ae[O])){
ar.set(ae[O]);
}
}
return ar.number();
};
u.setScriptBreakPointById=function(script_id,
ai,aj,
ao,opt_groupId,
opt_position_alignment){
return this.setScriptBreakPoint(u.ScriptBreakPointType.ScriptId,
script_id,ai,aj,
ao,opt_groupId,
opt_position_alignment);
};
u.setScriptBreakPointByName=function(script_name,
ai,aj,
ao,opt_groupId){
return this.setScriptBreakPoint(u.ScriptBreakPointType.ScriptName,
script_name,ai,aj,
ao,opt_groupId);
};
u.setScriptBreakPointByRegExp=function(script_regexp,
ai,aj,
ao,opt_groupId){
return this.setScriptBreakPoint(u.ScriptBreakPointType.ScriptRegExp,
script_regexp,ai,aj,
ao,opt_groupId);
};
u.enableScriptBreakPoint=function(am){
var ar=this.findScriptBreakPoint(am,false);
ar.enable();
};
u.disableScriptBreakPoint=function(am){
var ar=this.findScriptBreakPoint(am,false);
ar.disable();
};
u.changeScriptBreakPointCondition=function(
am,G){
var ar=this.findScriptBreakPoint(am,false);
ar.setCondition(G);
};
u.changeScriptBreakPointIgnoreCount=function(
am,H){
if(H<0)throw j(2,'Invalid argument');
var ar=this.findScriptBreakPoint(am,false);
ar.setIgnoreCount(H);
};
u.scriptBreakPoints=function(){
return A;
};
u.clearStepping=function(){
%ClearStepping();
};
u.setBreakOnException=function(){
return %ChangeBreakOnException(u.ExceptionBreak.Caught,true);
};
u.clearBreakOnException=function(){
return %ChangeBreakOnException(u.ExceptionBreak.Caught,false);
};
u.isBreakOnException=function(){
return!!%IsBreakOnException(u.ExceptionBreak.Caught);
};
u.setBreakOnUncaughtException=function(){
return %ChangeBreakOnException(u.ExceptionBreak.Uncaught,true);
};
u.clearBreakOnUncaughtException=function(){
return %ChangeBreakOnException(u.ExceptionBreak.Uncaught,false);
};
u.isBreakOnUncaughtException=function(){
return!!%IsBreakOnException(u.ExceptionBreak.Uncaught);
};
u.showBreakPoints=function(aa,as,at){
if(!(%_IsFunction(aa)))throw j(32);
var au=as?this.scriptSource(aa):this.source(aa);
var av=as?this.sourcePosition(aa):0;
var N=this.breakLocations(aa,at);
if(!N)return au;
N.sort(function(aw,ax){return aw-ax;});
var X="";
var ay=0;
var az;
for(var O=0;O<N.length;O++){
az=N[O]-av;
X+=au.slice(ay,az);
X+="[B"+O+"]";
ay=az;
}
az=au.length;
X+=au.substring(ay,az);
return X;
};
u.scripts=function(){
return %DebugGetLoadedScripts();
};
u.debuggerFlags=function(){
return B;
};
u.MakeMirror=l;
function MakeExecutionState(K){
return new ExecutionState(K);
}
function ExecutionState(K){
this.break_id=K;
this.selected_frame=0;
}
ExecutionState.prototype.prepareStep=function(aA){
if(aA===u.StepAction.StepIn||
aA===u.StepAction.StepOut||
aA===u.StepAction.StepNext||
aA===u.StepAction.StepFrame){
return %PrepareStep(this.break_id,aA);
}
throw k(32);
};
ExecutionState.prototype.evaluateGlobal=function(au,disable_break,
opt_additional_context){
return l(%DebugEvaluateGlobal(this.break_id,au,
(!!(disable_break)),
opt_additional_context));
};
ExecutionState.prototype.frameCount=function(){
return %GetFrameCount(this.break_id);
};
ExecutionState.prototype.threadCount=function(){
return %GetThreadCount(this.break_id);
};
ExecutionState.prototype.frame=function(aB){
if(aB==null)aB=this.selected_frame;
if(aB<0||aB>=this.frameCount()){
throw k(31);
}
return new c(this.break_id,aB);
};
ExecutionState.prototype.setSelectedFrame=function(aC){
var O=(%_ToNumber(aC));
if(O<0||O>=this.frameCount()){
throw k(31);
}
this.selected_frame=O;
};
ExecutionState.prototype.selectedFrame=function(){
return this.selected_frame;
};
ExecutionState.prototype.debugCommandProcessor=function(aD){
return new DebugCommandProcessor(this,aD);
};
function MakeBreakEvent(K,aE){
return new BreakEvent(K,aE);
}
function BreakEvent(K,aE){
this.frame_=new c(K,0);
this.break_points_hit_=aE;
}
BreakEvent.prototype.eventType=function(){
return u.DebugEvent.Break;
};
BreakEvent.prototype.func=function(){
return this.frame_.func();
};
BreakEvent.prototype.sourceLine=function(){
return this.frame_.sourceLine();
};
BreakEvent.prototype.sourceColumn=function(){
return this.frame_.sourceColumn();
};
BreakEvent.prototype.sourceLineText=function(){
return this.frame_.sourceLineText();
};
BreakEvent.prototype.breakPointsHit=function(){
return this.break_points_hit_;
};
BreakEvent.prototype.toJSONProtocol=function(){
var aF={seq:x++,
type:"event",
event:"break",
body:{invocationText:this.frame_.invocationText()}
};
var R=this.func().script();
if(R){
aF.body.sourceLine=this.sourceLine(),
aF.body.sourceColumn=this.sourceColumn(),
aF.body.sourceLineText=this.sourceLineText(),
aF.body.script=MakeScriptObject_(R,false);
}
if(this.breakPointsHit()){
aF.body.breakpoints=[];
for(var O=0;O<this.breakPointsHit().length;O++){
var aG=this.breakPointsHit()[O];
var ar=aG.script_break_point();
var aH;
if(ar){
aH=ar.number();
}else{
aH=aG.number();
}
aF.body.breakpoints.push(aH);
}
}
return h(ObjectToProtocolObject_(aF));
};
function MakeExceptionEvent(K,aI,aJ,aK){
return new ExceptionEvent(K,aI,aJ,aK);
}
function ExceptionEvent(K,aI,aJ,aK){
this.exec_state_=new ExecutionState(K);
this.exception_=aI;
this.uncaught_=aJ;
this.promise_=aK;
}
ExceptionEvent.prototype.eventType=function(){
return u.DebugEvent.Exception;
};
ExceptionEvent.prototype.exception=function(){
return this.exception_;
};
ExceptionEvent.prototype.uncaught=function(){
return this.uncaught_;
};
ExceptionEvent.prototype.promise=function(){
return this.promise_;
};
ExceptionEvent.prototype.func=function(){
return this.exec_state_.frame(0).func();
};
ExceptionEvent.prototype.sourceLine=function(){
return this.exec_state_.frame(0).sourceLine();
};
ExceptionEvent.prototype.sourceColumn=function(){
return this.exec_state_.frame(0).sourceColumn();
};
ExceptionEvent.prototype.sourceLineText=function(){
return this.exec_state_.frame(0).sourceLineText();
};
ExceptionEvent.prototype.toJSONProtocol=function(){
var aF=new ProtocolMessage();
aF.event="exception";
aF.body={uncaught:this.uncaught_,
exception:l(this.exception_)
};
if(this.exec_state_.frameCount()>0){
aF.body.sourceLine=this.sourceLine();
aF.body.sourceColumn=this.sourceColumn();
aF.body.sourceLineText=this.sourceLineText();
var R=this.func().script();
if(R){
aF.body.script=MakeScriptObject_(R,false);
}
}else{
aF.body.sourceLine=-1;
}
return aF.toJSONProtocol();
};
function MakeCompileEvent(R,w){
return new CompileEvent(R,w);
}
function CompileEvent(R,w){
this.script_=l(R);
this.type_=w;
}
CompileEvent.prototype.eventType=function(){
return this.type_;
};
CompileEvent.prototype.script=function(){
return this.script_;
};
CompileEvent.prototype.toJSONProtocol=function(){
var aF=new ProtocolMessage();
aF.running=true;
switch(this.type_){
case u.DebugEvent.BeforeCompile:
aF.event="beforeCompile";
break;
case u.DebugEvent.AfterCompile:
aF.event="afterCompile";
break;
case u.DebugEvent.CompileError:
aF.event="compileError";
break;
}
aF.body={};
aF.body.script=this.script_;
return aF.toJSONProtocol();
};
function MakeScriptObject_(R,aL){
var aF={id:R.id(),
name:R.name(),
lineOffset:R.lineOffset(),
columnOffset:R.columnOffset(),
lineCount:R.lineCount(),
};
if(!(R.data()===(void 0))){
aF.data=R.data();
}
if(aL){
aF.source=R.source();
}
return aF;
}
function MakePromiseEvent(aM){
return new PromiseEvent(aM);
}
function PromiseEvent(aM){
this.promise_=aM.promise;
this.parentPromise_=aM.parentPromise;
this.status_=aM.status;
this.value_=aM.value;
}
PromiseEvent.prototype.promise=function(){
return l(this.promise_);
}
PromiseEvent.prototype.parentPromise=function(){
return l(this.parentPromise_);
}
PromiseEvent.prototype.status=function(){
return this.status_;
}
PromiseEvent.prototype.value=function(){
return l(this.value_);
}
function MakeAsyncTaskEvent(aM){
return new AsyncTaskEvent(aM);
}
function AsyncTaskEvent(aM){
this.type_=aM.type;
this.name_=aM.name;
this.id_=aM.id;
}
AsyncTaskEvent.prototype.type=function(){
return this.type_;
}
AsyncTaskEvent.prototype.name=function(){
return this.name_;
}
AsyncTaskEvent.prototype.id=function(){
return this.id_;
}
function DebugCommandProcessor(I,aD){
this.exec_state_=I;
this.running_=aD||false;
}
DebugCommandProcessor.prototype.processDebugRequest=function(aN){
return this.processDebugJSONRequest(aN);
};
function ProtocolMessage(aN){
this.seq=x++;
if(aN){
this.type='response';
this.request_seq=aN.seq;
this.command=aN.command;
}else{
this.type='event';
}
this.success=true;
this.running=(void 0);
}
ProtocolMessage.prototype.setOption=function(aO,C){
if(!this.options_){
this.options_={};
}
this.options_[aO]=C;
};
ProtocolMessage.prototype.failed=function(aP,aQ){
this.success=false;
this.message=aP;
if((typeof(aQ)==='object')){
this.error_details=aQ;
}
};
ProtocolMessage.prototype.toJSONProtocol=function(){
var aR={};
aR.seq=this.seq;
if(this.request_seq){
aR.request_seq=this.request_seq;
}
aR.type=this.type;
if(this.event){
aR.event=this.event;
}
if(this.command){
aR.command=this.command;
}
if(this.success){
aR.success=this.success;
}else{
aR.success=false;
}
if(this.body){
var aS;
var aT=m(true,this.options_);
if(this.body instanceof o){
aS=aT.serializeValue(this.body);
}else if(this.body instanceof d){
aS=[];
for(var O=0;O<this.body.length;O++){
if(this.body[O]instanceof o){
aS.push(aT.serializeValue(this.body[O]));
}else{
aS.push(ObjectToProtocolObject_(this.body[O],aT));
}
}
}else{
aS=ObjectToProtocolObject_(this.body,aT);
}
aR.body=aS;
aR.refs=aT.serializeReferencedObjects();
}
if(this.message){
aR.message=this.message;
}
if(this.error_details){
aR.error_details=this.error_details;
}
aR.running=this.running;
return h(aR);
};
DebugCommandProcessor.prototype.createResponse=function(aN){
return new ProtocolMessage(aN);
};
DebugCommandProcessor.prototype.processDebugJSONRequest=function(
json_request){
var aN;
var aU;
try{
try{
aN=g(json_request);
aU=this.createResponse(aN);
if(!aN.type){
throw j(2,'Type not specified');
}
if(aN.type!='request'){
throw j(2,
"Illegal type '"+aN.type+"' in request");
}
if(!aN.command){
throw j(2,'Command not specified');
}
if(aN.arguments){
var aV=aN.arguments;
if(aV.inlineRefs||aV.compactFormat){
aU.setOption('inlineRefs',true);
}
if(!(aV.maxStringLength===(void 0))){
aU.setOption('maxStringLength',aV.maxStringLength);
}
}
var aW=aN.command.toLowerCase();
var aX=DebugCommandProcessor.prototype.dispatch_[aW];
if((%_IsFunction(aX))){
%_Call(aX,this,aN,aU);
}else{
throw j(2,
'Unknown command "'+aN.command+'" in request');
}
}catch(e){
if(!aU){
aU=this.createResponse();
}
aU.success=false;
aU.message=(%_ToString(e));
}
try{
if(!(aU.running===(void 0))){
this.running_=aU.running;
}
aU.running=this.running_;
return aU.toJSONProtocol();
}catch(e){
return'{"seq":'+aU.seq+','+
'"request_seq":'+aN.seq+','+
'"type":"response",'+
'"success":false,'+
'"message":"Internal error: '+(%_ToString(e))+'"}';
}
}catch(e){
return'{"seq":0,"type":"response","success":false,"message":"Internal error"}';
}
};
DebugCommandProcessor.prototype.continueRequest_=function(aN,aU){
if(aN.arguments){
var aA=u.StepAction.StepIn;
var aY=aN.arguments.stepaction;
if(aY){
if(aY=='in'){
aA=u.StepAction.StepIn;
}else if(aY=='next'){
aA=u.StepAction.StepNext;
}else if(aY=='out'){
aA=u.StepAction.StepOut;
}else{
throw j(2,
'Invalid stepaction argument "'+aY+'".');
}
}
this.exec_state_.prepareStep(aA);
}
aU.running=true;
};
DebugCommandProcessor.prototype.breakRequest_=function(aN,aU){
};
DebugCommandProcessor.prototype.setBreakPointRequest_=
function(aN,aU){
if(!aN.arguments){
aU.failed('Missing arguments');
return;
}
var w=aN.arguments.type;
var aZ=aN.arguments.target;
var P=aN.arguments.line;
var Q=aN.arguments.column;
var ba=(aN.arguments.enabled===(void 0))?
true:aN.arguments.enabled;
var G=aN.arguments.condition;
var H=aN.arguments.ignoreCount;
var bb=aN.arguments.groupId;
if(!w||(aZ===(void 0))){
aU.failed('Missing argument "type" or "target"');
return;
}
var am;
if(w=='function'){
if(!(typeof(aZ)==='string')){
aU.failed('Argument "target" is not a string value');
return;
}
var aa;
try{
aa=this.exec_state_.evaluateGlobal(aZ).value();
}catch(e){
aU.failed('Error: "'+(%_ToString(e))+
'" evaluating "'+aZ+'"');
return;
}
if(!(%_IsFunction(aa))){
aU.failed('"'+aZ+'" does not evaluate to a function');
return;
}
am=u.setBreakPoint(aa,P,Q,G);
}else if(w=='handle'){
var bc=q(aZ,10);
var J=i(bc);
if(!J){
return aU.failed('Object #'+bc+'# not found');
}
if(!J.isFunction()){
return aU.failed('Object #'+bc+'# is not a function');
}
am=u.setBreakPoint(J.value(),
P,Q,G);
}else if(w=='script'){
am=
u.setScriptBreakPointByName(aZ,P,Q,G,
bb);
}else if(w=='scriptId'){
am=
u.setScriptBreakPointById(aZ,P,Q,G,bb);
}else if(w=='scriptRegExp'){
am=
u.setScriptBreakPointByRegExp(aZ,P,Q,G,
bb);
}else{
aU.failed('Illegal type "'+w+'"');
return;
}
var F=u.findBreakPoint(am);
if(H){
u.changeBreakPointIgnoreCount(am,H);
}
if(!ba){
u.disableBreakPoint(am);
}
aU.body={type:w,
breakpoint:am};
if(F instanceof ScriptBreakPoint){
if(F.type()==u.ScriptBreakPointType.ScriptId){
aU.body.type='scriptId';
aU.body.script_id=F.script_id();
}else if(F.type()==u.ScriptBreakPointType.ScriptName){
aU.body.type='scriptName';
aU.body.script_name=F.script_name();
}else if(F.type()==u.ScriptBreakPointType.ScriptRegExp){
aU.body.type='scriptRegExp';
aU.body.script_regexp=F.script_regexp_object().source;
}else{
throw j(2,
"Unexpected breakpoint type: "+F.type());
}
aU.body.line=F.line();
aU.body.column=F.column();
aU.body.actual_locations=F.actual_locations();
}else{
aU.body.type='function';
aU.body.actual_locations=[F.actual_location];
}
};
DebugCommandProcessor.prototype.changeBreakPointRequest_=function(
aN,aU){
if(!aN.arguments){
aU.failed('Missing arguments');
return;
}
var F=(%_ToNumber(aN.arguments.breakpoint));
var ba=aN.arguments.enabled;
var G=aN.arguments.condition;
var H=aN.arguments.ignoreCount;
if(!F){
aU.failed('Missing argument "breakpoint"');
return;
}
if(!(ba===(void 0))){
if(ba){
u.enableBreakPoint(F);
}else{
u.disableBreakPoint(F);
}
}
if(!(G===(void 0))){
u.changeBreakPointCondition(F,G);
}
if(!(H===(void 0))){
u.changeBreakPointIgnoreCount(F,H);
}
};
DebugCommandProcessor.prototype.clearBreakPointGroupRequest_=function(
aN,aU){
if(!aN.arguments){
aU.failed('Missing arguments');
return;
}
var bd=aN.arguments.groupId;
if(!bd){
aU.failed('Missing argument "groupId"');
return;
}
var be=[];
var bf=[];
for(var O=0;O<A.length;O++){
var bg=A[O];
if(bg.groupId()==bd){
be.push(bg.number());
bg.clear();
}else{
bf.push(bg);
}
}
A=bf;
aU.body={breakpoints:be};
};
DebugCommandProcessor.prototype.clearBreakPointRequest_=function(
aN,aU){
if(!aN.arguments){
aU.failed('Missing arguments');
return;
}
var F=(%_ToNumber(aN.arguments.breakpoint));
if(!F){
aU.failed('Missing argument "breakpoint"');
return;
}
u.clearBreakPoint(F);
aU.body={breakpoint:F};
};
DebugCommandProcessor.prototype.listBreakpointsRequest_=function(
aN,aU){
var bh=[];
for(var O=0;O<A.length;O++){
var F=A[O];
var bi={
number:F.number(),
line:F.line(),
column:F.column(),
groupId:F.groupId(),
hit_count:F.hit_count(),
active:F.active(),
condition:F.condition(),
ignoreCount:F.ignoreCount(),
actual_locations:F.actual_locations()
};
if(F.type()==u.ScriptBreakPointType.ScriptId){
bi.type='scriptId';
bi.script_id=F.script_id();
}else if(F.type()==u.ScriptBreakPointType.ScriptName){
bi.type='scriptName';
bi.script_name=F.script_name();
}else if(F.type()==u.ScriptBreakPointType.ScriptRegExp){
bi.type='scriptRegExp';
bi.script_regexp=F.script_regexp_object().source;
}else{
throw j(2,
"Unexpected breakpoint type: "+F.type());
}
bh.push(bi);
}
aU.body={
breakpoints:bh,
breakOnExceptions:u.isBreakOnException(),
breakOnUncaughtExceptions:u.isBreakOnUncaughtException()
};
};
DebugCommandProcessor.prototype.disconnectRequest_=
function(aN,aU){
u.disableAllBreakPoints();
this.continueRequest_(aN,aU);
};
DebugCommandProcessor.prototype.setExceptionBreakRequest_=
function(aN,aU){
if(!aN.arguments){
aU.failed('Missing arguments');
return;
}
var w=aN.arguments.type;
if(!w){
aU.failed('Missing argument "type"');
return;
}
var ba;
if(w=='all'){
ba=!u.isBreakOnException();
}else if(w=='uncaught'){
ba=!u.isBreakOnUncaughtException();
}
if(!(aN.arguments.enabled===(void 0))){
ba=aN.arguments.enabled;
if((ba!=true)&&(ba!=false)){
aU.failed('Illegal value for "enabled":"'+ba+'"');
}
}
if(w=='all'){
%ChangeBreakOnException(u.ExceptionBreak.Caught,ba);
}else if(w=='uncaught'){
%ChangeBreakOnException(u.ExceptionBreak.Uncaught,ba);
}else{
aU.failed('Unknown "type":"'+w+'"');
}
aU.body={'type':w,'enabled':ba};
};
DebugCommandProcessor.prototype.backtraceRequest_=function(
aN,aU){
var bj=this.exec_state_.frameCount();
if(bj==0){
aU.body={
totalFrames:bj
};
return;
}
var bk=0;
var bl=t;
if(aN.arguments){
if(aN.arguments.fromFrame){
bk=aN.arguments.fromFrame;
}
if(aN.arguments.toFrame){
bl=aN.arguments.toFrame;
}
if(aN.arguments.bottom){
var bm=bj-bk;
bk=bj-bl;
bl=bm;
}
if(bk<0||bl<0){
return aU.failed('Invalid frame number');
}
}
bl=n(bj,bl);
if(bl<=bk){
var bn='Invalid frame range';
return aU.failed(bn);
}
var bo=[];
for(var O=bk;O<bl;O++){
bo.push(this.exec_state_.frame(O));
}
aU.body={
fromFrame:bk,
toFrame:bl,
totalFrames:bj,
frames:bo
};
};
DebugCommandProcessor.prototype.frameRequest_=function(aN,aU){
if(this.exec_state_.frameCount()==0){
return aU.failed('No frames');
}
if(aN.arguments){
var aC=aN.arguments.number;
if(aC<0||this.exec_state_.frameCount()<=aC){
return aU.failed('Invalid frame number');
}
this.exec_state_.setSelectedFrame(aN.arguments.number);
}
aU.body=this.exec_state_.frame();
};
DebugCommandProcessor.prototype.resolveFrameFromScopeDescription_=
function(bp){
if(bp&&!(bp.frameNumber===(void 0))){
var bq=bp.frameNumber;
if(bq<0||this.exec_state_.frameCount()<=bq){
throw k(31);
}
return this.exec_state_.frame(bq);
}else{
return this.exec_state_.frame();
}
};
DebugCommandProcessor.prototype.resolveScopeHolder_=
function(bp){
if(bp&&"functionHandle"in bp){
if(!(typeof(bp.functionHandle)==='number')){
throw j(2,'Function handle must be a number');
}
var br=i(bp.functionHandle);
if(!br){
throw j(2,'Failed to find function object by handle');
}
if(!br.isFunction()){
throw j(2,
'Value of non-function type is found by handle');
}
return br;
}else{
if(this.exec_state_.frameCount()==0){
throw j(2,'No scopes');
}
var bs=this.resolveFrameFromScopeDescription_(bp);
return bs;
}
}
DebugCommandProcessor.prototype.scopesRequest_=function(aN,aU){
var bt=this.resolveScopeHolder_(aN.arguments);
var bu=bt.scopeCount();
var bv=[];
for(var O=0;O<bu;O++){
bv.push(bt.scope(O));
}
aU.body={
fromScope:0,
toScope:bu,
totalScopes:bu,
scopes:bv
};
};
DebugCommandProcessor.prototype.scopeRequest_=function(aN,aU){
var bt=this.resolveScopeHolder_(aN.arguments);
var bw=0;
if(aN.arguments&&!(aN.arguments.number===(void 0))){
bw=(%_ToNumber(aN.arguments.number));
if(bw<0||bt.scopeCount()<=bw){
return aU.failed('Invalid scope number');
}
}
aU.body=bt.scope(bw);
};
DebugCommandProcessor.resolveValue_=function(bx){
if("handle"in bx){
var by=i(bx.handle);
if(!by){
throw j(2,"Failed to resolve value by handle, ' #"+
bx.handle+"# not found");
}
return by.value();
}else if("stringDescription"in bx){
if(bx.type==p.BOOLEAN_TYPE){
return(!!(bx.stringDescription));
}else if(bx.type==p.NUMBER_TYPE){
return(%_ToNumber(bx.stringDescription));
}if(bx.type==p.STRING_TYPE){
return(%_ToString(bx.stringDescription));
}else{
throw j(2,"Unknown type");
}
}else if("value"in bx){
return bx.value;
}else if(bx.type==p.UNDEFINED_TYPE){
return(void 0);
}else if(bx.type==p.NULL_TYPE){
return null;
}else{
throw j(2,"Failed to parse value description");
}
};
DebugCommandProcessor.prototype.setVariableValueRequest_=
function(aN,aU){
if(!aN.arguments){
aU.failed('Missing arguments');
return;
}
if((aN.arguments.name===(void 0))){
aU.failed('Missing variable name');
}
var bz=aN.arguments.name;
var bp=aN.arguments.scope;
var bt=this.resolveScopeHolder_(bp);
if((bp.number===(void 0))){
aU.failed('Missing scope number');
}
var bw=(%_ToNumber(bp.number));
var bA=bt.scope(bw);
var bB=
DebugCommandProcessor.resolveValue_(aN.arguments.newValue);
bA.setVariableValue(bz,bB);
var bC=l(bB);
aU.body={
newValue:bC
};
};
DebugCommandProcessor.prototype.evaluateRequest_=function(aN,aU){
if(!aN.arguments){
return aU.failed('Missing arguments');
}
var bD=aN.arguments.expression;
var bs=aN.arguments.frame;
var a=aN.arguments.global;
var bE=aN.arguments.disable_break;
var bF=aN.arguments.additional_context;
try{
bD=(%_ToString(bD));
}catch(e){
return aU.failed('Failed to convert expression argument to string');
}
if(!(bs===(void 0))&&a){
return aU.failed('Arguments "frame" and "global" are exclusive');
}
var bG;
if(bF){
bG={};
for(var O=0;O<bF.length;O++){
var bH=bF[O];
if(!(typeof(bH.name)==='string')){
return aU.failed("Context element #"+O+
" doesn't contain name:string property");
}
var bI=DebugCommandProcessor.resolveValue_(bH);
bG[bH.name]=bI;
}
}
if(a){
aU.body=this.exec_state_.evaluateGlobal(
bD,(!!(bE)),bG);
return;
}
if((bE===(void 0))){
bE=true;
}
if(this.exec_state_.frameCount()==0){
return aU.failed('No frames');
}
if(!(bs===(void 0))){
var bJ=(%_ToNumber(bs));
if(bJ<0||bJ>=this.exec_state_.frameCount()){
return aU.failed('Invalid frame "'+bs+'"');
}
aU.body=this.exec_state_.frame(bJ).evaluate(
bD,(!!(bE)),bG);
return;
}else{
aU.body=this.exec_state_.frame().evaluate(
bD,(!!(bE)),bG);
return;
}
};
DebugCommandProcessor.prototype.lookupRequest_=function(aN,aU){
if(!aN.arguments){
return aU.failed('Missing arguments');
}
var bK=aN.arguments.handles;
if((bK===(void 0))){
return aU.failed('Argument "handles" missing');
}
if(!(aN.arguments.includeSource===(void 0))){
var bL=(!!(aN.arguments.includeSource));
aU.setOption('includeSource',bL);
}
var bM={};
for(var O=0;O<bK.length;O++){
var bc=bK[O];
var J=i(bc);
if(!J){
return aU.failed('Object #'+bc+'# not found');
}
bM[bc]=J;
}
aU.body=bM;
};
DebugCommandProcessor.prototype.referencesRequest_=
function(aN,aU){
if(!aN.arguments){
return aU.failed('Missing arguments');
}
var w=aN.arguments.type;
var bc=aN.arguments.handle;
if((w===(void 0))){
return aU.failed('Argument "type" missing');
}
if((bc===(void 0))){
return aU.failed('Argument "handle" missing');
}
if(w!='referencedBy'&&w!='constructedBy'){
return aU.failed('Invalid type "'+w+'"');
}
var J=i(bc);
if(J){
if(w=='referencedBy'){
aU.body=J.referencedBy();
}else{
aU.body=J.constructedBy();
}
}else{
return aU.failed('Object #'+bc+'# not found');
}
};
DebugCommandProcessor.prototype.sourceRequest_=function(aN,aU){
if(this.exec_state_.frameCount()==0){
return aU.failed('No source');
}
var bN;
var bO;
var bs=this.exec_state_.frame();
if(aN.arguments){
bN=aN.arguments.fromLine;
bO=aN.arguments.toLine;
if(!(aN.arguments.frame===(void 0))){
var bJ=(%_ToNumber(aN.arguments.frame));
if(bJ<0||bJ>=this.exec_state_.frameCount()){
return aU.failed('Invalid frame "'+bs+'"');
}
bs=this.exec_state_.frame(bJ);
}
}
var R=bs.func().script();
if(!R){
return aU.failed('No source');
}
var bP=R.sourceSlice(bN,bO);
if(!bP){
return aU.failed('Invalid line interval');
}
aU.body={};
aU.body.source=bP.sourceText();
aU.body.fromLine=bP.from_line;
aU.body.toLine=bP.to_line;
aU.body.fromPosition=bP.from_position;
aU.body.toPosition=bP.to_position;
aU.body.totalLines=R.lineCount();
};
DebugCommandProcessor.prototype.scriptsRequest_=function(aN,aU){
var bQ=ScriptTypeFlag(u.ScriptType.Normal);
var bL=false;
var bR=null;
if(aN.arguments){
if(!(aN.arguments.types===(void 0))){
bQ=(%_ToNumber(aN.arguments.types));
if(f(bQ)||bQ<0){
return aU.failed('Invalid types "'+
aN.arguments.types+'"');
}
}
if(!(aN.arguments.includeSource===(void 0))){
bL=(!!(aN.arguments.includeSource));
aU.setOption('includeSource',bL);
}
if((%_IsArray(aN.arguments.ids))){
bR={};
var bS=aN.arguments.ids;
for(var O=0;O<bS.length;O++){
bR[bS[O]]=true;
}
}
var bT=null;
var bU=null;
if(!(aN.arguments.filter===(void 0))){
var bV=(%_ToNumber(aN.arguments.filter));
if(!f(bV)){
bU=bV;
}
bT=aN.arguments.filter;
}
}
var ae=%DebugGetLoadedScripts();
aU.body=[];
for(var O=0;O<ae.length;O++){
if(bR&&!bR[ae[O].id]){
continue;
}
if(bT||bU){
var R=ae[O];
var bW=false;
if(bU&&!bW){
if(R.id&&R.id===bU){
bW=true;
}
}
if(bT&&!bW){
if(R.name&&R.name.indexOf(bT)>=0){
bW=true;
}
}
if(!bW)continue;
}
if(bQ&ScriptTypeFlag(ae[O].type)){
aU.body.push(l(ae[O]));
}
}
};
DebugCommandProcessor.prototype.threadsRequest_=function(aN,aU){
var bX=this.exec_state_.threadCount();
var bY=[];
for(var O=0;O<bX;O++){
var bZ=%GetThreadDetails(this.exec_state_.break_id,O);
var ca={current:bZ[0],
id:bZ[1]
};
bY.push(ca);
}
aU.body={
totalThreads:bX,
threads:bY
};
};
DebugCommandProcessor.prototype.suspendRequest_=function(aN,aU){
aU.running=false;
};
DebugCommandProcessor.prototype.versionRequest_=function(aN,aU){
aU.body={
V8Version:%GetV8Version()
};
};
DebugCommandProcessor.prototype.changeLiveRequest_=function(
aN,aU){
if(!aN.arguments){
return aU.failed('Missing arguments');
}
var cb=aN.arguments.script_id;
var cc=!!aN.arguments.preview_only;
var ae=%DebugGetLoadedScripts();
var cd=null;
for(var O=0;O<ae.length;O++){
if(ae[O].id==cb){
cd=ae[O];
}
}
if(!cd){
aU.failed('Script not found');
return;
}
var ce=new d();
if(!(typeof(aN.arguments.new_source)==='string')){
throw"new_source argument expected";
}
var cf=aN.arguments.new_source;
var cg;
try{
cg=u.LiveEdit.SetScriptSource(cd,
cf,cc,ce);
}catch(e){
if(e instanceof u.LiveEdit.Failure&&"details"in e){
aU.failed(e.message,e.details);
return;
}
throw e;
}
aU.body={change_log:ce,result:cg};
if(!cc&&!this.running_&&cg.stack_modified){
aU.body.stepin_recommended=true;
}
};
DebugCommandProcessor.prototype.restartFrameRequest_=function(
aN,aU){
if(!aN.arguments){
return aU.failed('Missing arguments');
}
var bs=aN.arguments.frame;
if(this.exec_state_.frameCount()==0){
return aU.failed('No frames');
}
var ch;
if(!(bs===(void 0))){
var bJ=(%_ToNumber(bs));
if(bJ<0||bJ>=this.exec_state_.frameCount()){
return aU.failed('Invalid frame "'+bs+'"');
}
ch=this.exec_state_.frame(bJ);
}else{
ch=this.exec_state_.frame();
}
var cg=u.LiveEdit.RestartFrame(ch);
aU.body={result:cg};
};
DebugCommandProcessor.prototype.debuggerFlagsRequest_=function(aN,
aU){
if(!aN.arguments){
aU.failed('Missing arguments');
return;
}
var ci=aN.arguments.flags;
aU.body={flags:[]};
if(!(ci===(void 0))){
for(var O=0;O<ci.length;O++){
var aO=ci[O].name;
var cj=B[aO];
if(!cj){
continue;
}
if('value'in ci[O]){
cj.setValue(ci[O].value);
}
aU.body.flags.push({name:aO,value:cj.getValue()});
}
}else{
for(var aO in B){
var C=B[aO].getValue();
aU.body.flags.push({name:aO,value:C});
}
}
};
DebugCommandProcessor.prototype.v8FlagsRequest_=function(aN,aU){
var ci=aN.arguments.flags;
if(!ci)ci='';
%SetFlags(ci);
};
DebugCommandProcessor.prototype.gcRequest_=function(aN,aU){
var w=aN.arguments.type;
if(!w)w='all';
var ck=%GetHeapUsage();
%CollectGarbage(w);
var cl=%GetHeapUsage();
aU.body={"before":ck,"after":cl};
};
DebugCommandProcessor.prototype.dispatch_=(function(){
var cm=DebugCommandProcessor.prototype;
return{
"continue":cm.continueRequest_,
"break":cm.breakRequest_,
"setbreakpoint":cm.setBreakPointRequest_,
"changebreakpoint":cm.changeBreakPointRequest_,
"clearbreakpoint":cm.clearBreakPointRequest_,
"clearbreakpointgroup":cm.clearBreakPointGroupRequest_,
"disconnect":cm.disconnectRequest_,
"setexceptionbreak":cm.setExceptionBreakRequest_,
"listbreakpoints":cm.listBreakpointsRequest_,
"backtrace":cm.backtraceRequest_,
"frame":cm.frameRequest_,
"scopes":cm.scopesRequest_,
"scope":cm.scopeRequest_,
"setvariablevalue":cm.setVariableValueRequest_,
"evaluate":cm.evaluateRequest_,
"lookup":cm.lookupRequest_,
"references":cm.referencesRequest_,
"source":cm.sourceRequest_,
"scripts":cm.scriptsRequest_,
"threads":cm.threadsRequest_,
"suspend":cm.suspendRequest_,
"version":cm.versionRequest_,
"changelive":cm.changeLiveRequest_,
"restartframe":cm.restartFrameRequest_,
"flags":cm.debuggerFlagsRequest_,
"v8flag":cm.v8FlagsRequest_,
"gc":cm.gcRequest_,
};
})();
DebugCommandProcessor.prototype.isRunning=function(){
return this.running_;
};
DebugCommandProcessor.prototype.systemBreak=function(cn,aV){
return %SystemBreak();
};
function ObjectToProtocolObject_(co,cp){
var cq={};
for(var aW in co){
if(typeof aW=='string'){
var cr=ValueToProtocolValue_(co[aW],
cp);
if(!(cr===(void 0))){
cq[aW]=cr;
}
}
}
return cq;
}
function ArrayToProtocolArray_(bh,cp){
var aR=[];
for(var O=0;O<bh.length;O++){
aR.push(ValueToProtocolValue_(bh[O],cp));
}
return aR;
}
function ValueToProtocolValue_(C,cp){
var aR;
switch(typeof C){
case'object':
if(C instanceof o){
aR=cp.serializeValue(C);
}else if((%_IsArray(C))){
aR=ArrayToProtocolArray_(C,cp);
}else{
aR=ObjectToProtocolObject_(C,cp);
}
break;
case'boolean':
case'string':
case'number':
aR=C;
break;
default:
aR=null;
}
return aR;
}
b.InstallConstants(a,[
"Debug",u,
"DebugCommandProcessor",DebugCommandProcessor,
"BreakEvent",BreakEvent,
"CompileEvent",CompileEvent,
"BreakPoint",BreakPoint,
]);
b.InstallFunctions(b,2,[
"MakeExecutionState",MakeExecutionState,
"MakeExceptionEvent",MakeExceptionEvent,
"MakeBreakEvent",MakeBreakEvent,
"MakeCompileEvent",MakeCompileEvent,
"MakePromiseEvent",MakePromiseEvent,
"MakeAsyncTaskEvent",MakeAsyncTaskEvent,
"IsBreakPointTriggered",IsBreakPointTriggered,
"UpdateScriptBreakPoints",UpdateScriptBreakPoints,
]);
b.Export(function(cs){
cs.GetScriptBreakPoints=GetScriptBreakPoints;
});
})

 liveedit%ú
(function(a,b){
"use strict";
var c=a.Debug.findScriptSourcePosition;
var d;
var e=a.Array;
var f=a.Math.floor;
var g=a.SyntaxError;
b.Import(function(h){
d=h.GetScriptBreakPoints;
});
var i;
function ApplyPatchMultiChunk(script,diff_array,new_source,preview_only,
change_log){
var j=script.source;
var k=GatherCompileInfo(j,script);
var l=BuildCodeInfoTree(k);
var m=new PosTranslator(diff_array);
MarkChangedFunctions(l,m.GetChunks());
FindLiveSharedInfos(l,script);
var n;
try{
n=GatherCompileInfo(new_source,script);
}catch(e){
var o=
new Failure("Failed to compile new version of script: "+e);
if(e instanceof g){
var p={
type:"liveedit_compile_error",
syntaxErrorMessage:e.message
};
CopyErrorPositionToDetails(e,p);
o.details=p;
}
throw o;
}
var q=BuildCodeInfoTree(n);
FindCorrespondingFunctions(l,q);
var r=new e();
var s=new e();
var t=new e();
var u=new e();
function HarvestTodo(v){
function CollectDamaged(w){
s.push(w);
for(var x=0;x<w.children.length;x++){
CollectDamaged(w.children[x]);
}
}
function CollectNew(y){
for(var x=0;x<y.length;x++){
t.push(y[x]);
CollectNew(y[x].children);
}
}
if(v.status==i.DAMAGED){
CollectDamaged(v);
return;
}
if(v.status==i.UNCHANGED){
u.push(v);
}else if(v.status==i.SOURCE_CHANGED){
u.push(v);
}else if(v.status==i.CHANGED){
r.push(v);
CollectNew(v.unmatched_new_nodes);
}
for(var x=0;x<v.children.length;x++){
HarvestTodo(v.children[x]);
}
}
var z={
change_tree:DescribeChangeTree(l),
textual_diff:{
old_len:j.length,
new_len:new_source.length,
chunks:diff_array
},
updated:false
};
if(preview_only){
return z;
}
HarvestTodo(l);
var A=new e();
var B=new e();
for(var x=0;x<r.length;x++){
var C=r[x].live_shared_function_infos;
var D=
r[x].corresponding_node.info.shared_function_info;
if(C){
for(var E=0;E<C.length;E++){
A.push(C[E]);
B.push(D);
}
}
}
var F=
CheckStackActivations(A,
B,
change_log);
z.stack_modified=F!=0;
var G=TemporaryRemoveBreakPoints(script,change_log);
var H;
if(s.length==0){
%LiveEditReplaceScript(script,new_source,null);
H=(void 0);
}else{
var I=CreateNameForOldScript(script);
H=%LiveEditReplaceScript(script,new_source,
I);
var J=new e();
change_log.push({linked_to_old_script:J});
for(var x=0;x<s.length;x++){
LinkToOldScript(s[x],H,
J);
}
z.created_script_name=I;
}
for(var x=0;x<t.length;x++){
%LiveEditFunctionSetScript(
t[x].info.shared_function_info,script);
}
for(var x=0;x<r.length;x++){
PatchFunctionCode(r[x],change_log);
}
var K=new e();
change_log.push({position_patched:K});
for(var x=0;x<u.length;x++){
PatchPositions(u[x],diff_array,
K);
if(u[x].live_shared_function_infos){
u[x].live_shared_function_infos.
forEach(function(L){
%LiveEditFunctionSourceUpdated(L.raw_array);
});
}
}
G(m,H);
z.updated=true;
return z;
}
function GatherCompileInfo(M,N){
var O=%LiveEditGatherCompileInfo(N,M);
var P=new e();
var Q=new e();
for(var x=0;x<O.length;x++){
var L=new FunctionCompileInfo(O[x]);
%LiveEditFunctionSetScript(L.shared_function_info,(void 0));
P.push(L);
Q.push(x);
}
for(var x=0;x<P.length;x++){
var R=x;
for(var E=x+1;E<P.length;E++){
if(P[R].start_position>P[E].start_position){
R=E;
}
}
if(R!=x){
var S=P[R];
var T=Q[R];
P[R]=P[x];
Q[R]=Q[x];
P[x]=S;
Q[x]=T;
}
}
var U=0;
function ResetIndexes(V,W){
var X=-1;
while(U<P.length&&
P[U].outer_index==W){
var Y=U;
P[Y].outer_index=V;
if(X!=-1){
P[X].next_sibling_index=Y;
}
X=Y;
U++;
ResetIndexes(Y,Q[Y]);
}
if(X!=-1){
P[X].next_sibling_index=-1;
}
}
ResetIndexes(-1,-1);
Assert(U==P.length);
return P;
}
function PatchFunctionCode(v,Z){
var D=v.corresponding_node.info;
if(v.live_shared_function_infos){
v.live_shared_function_infos.forEach(function(aa){
%LiveEditReplaceFunctionCode(D.raw_array,
aa.raw_array);
for(var x=0;x<v.children.length;x++){
if(v.children[x].corresponding_node){
var ab=
v.children[x].corresponding_node.info.
shared_function_info;
if(v.children[x].live_shared_function_infos){
v.children[x].live_shared_function_infos.
forEach(function(ac){
%LiveEditReplaceRefToNestedFunction(
aa.info,
ab,
ac.info);
});
}
}
}
});
Z.push({function_patched:D.function_name});
}else{
Z.push({function_patched:D.function_name,
function_info_not_found:true});
}
}
function LinkToOldScript(ad,H,ae){
if(ad.live_shared_function_infos){
ad.live_shared_function_infos.
forEach(function(L){
%LiveEditFunctionSetScript(L.info,H);
});
ae.push({name:ad.info.function_name});
}else{
ae.push(
{name:ad.info.function_name,not_found:true});
}
}
function TemporaryRemoveBreakPoints(af,Z){
var ag=d(af);
var ah=[];
Z.push({break_points_update:ah});
var ai=[];
for(var x=0;x<ag.length;x++){
var aj=ag[x];
aj.clear();
var ak=c(af,
aj.line(),aj.column());
var al={
position:ak,
line:aj.line(),
column:aj.column()
};
ai.push(al);
}
return function(m,am){
for(var x=0;x<ag.length;x++){
var aj=ag[x];
if(am){
var an=aj.cloneForOtherScript(am);
an.set(am);
ah.push({
type:"copied_to_old",
id:aj.number(),
new_id:an.number(),
positions:ai[x]
});
}
var ao=m.Translate(
ai[x].position,
PosTranslator.ShiftWithTopInsideChunkHandler);
var ap=
af.locationFromPosition(ao,false);
aj.update_positions(ap.line,ap.column);
var aq={
position:ao,
line:ap.line,
column:ap.column
};
aj.set(af);
ah.push({type:"position_changed",
id:aj.number(),
old_positions:ai[x],
new_positions:aq
});
}
};
}
function Assert(ar,as){
if(!ar){
if(as){
throw"Assert "+as;
}else{
throw"Assert";
}
}
}
function DiffChunk(at,au,av,aw){
this.pos1=at;
this.pos2=au;
this.len1=av;
this.len2=aw;
}
function PosTranslator(ax){
var ay=new e();
var az=0;
for(var x=0;x<ax.length;x+=3){
var aA=ax[x];
var aB=aA+az;
var aC=ax[x+1];
var aD=ax[x+2];
ay.push(new DiffChunk(aA,aB,aC-aA,
aD-aB));
az=aD-aC;
}
this.chunks=ay;
}
PosTranslator.prototype.GetChunks=function(){
return this.chunks;
};
PosTranslator.prototype.Translate=function(aE,aF){
var aG=this.chunks;
if(aG.length==0||aE<aG[0].pos1){
return aE;
}
var aH=0;
var aI=aG.length-1;
while(aH<aI){
var aJ=f((aH+aI)/2);
if(aE<aG[aJ+1].pos1){
aI=aJ;
}else{
aH=aJ+1;
}
}
var aK=aG[aH];
if(aE>=aK.pos1+aK.len1){
return aE+aK.pos2+aK.len2-aK.pos1-aK.len1;
}
if(!aF){
aF=PosTranslator.DefaultInsideChunkHandler;
}
return aF(aE,aK);
};
PosTranslator.DefaultInsideChunkHandler=function(aE,aL){
Assert(false,"Cannot translate position in changed area");
};
PosTranslator.ShiftWithTopInsideChunkHandler=
function(aE,aL){
return aE-aL.pos1+aL.pos2;
};
var i={
UNCHANGED:"unchanged",
SOURCE_CHANGED:"source changed",
CHANGED:"changed",
DAMAGED:"damaged"
};
function CodeInfoTreeNode(aM,aN,aO){
this.info=aM;
this.children=aN;
this.array_index=aO;
this.parent=(void 0);
this.status=i.UNCHANGED;
this.status_explanation=(void 0);
this.new_start_pos=(void 0);
this.new_end_pos=(void 0);
this.corresponding_node=(void 0);
this.unmatched_new_nodes=(void 0);
this.textual_corresponding_node=(void 0);
this.textually_unmatched_new_nodes=(void 0);
this.live_shared_function_infos=(void 0);
}
function BuildCodeInfoTree(aP){
var aQ=0;
function BuildNode(){
var aR=aQ;
aQ++;
var aS=new e();
while(aQ<aP.length&&
aP[aQ].outer_index==aR){
aS.push(BuildNode());
}
var w=new CodeInfoTreeNode(aP[aR],aS,
aR);
for(var x=0;x<aS.length;x++){
aS[x].parent=w;
}
return w;
}
var aT=BuildNode();
Assert(aQ==aP.length);
return aT;
}
function MarkChangedFunctions(aU,ay){
var aV=new function(){
var aW=0;
var aX=0;
this.current=function(){return ay[aW];};
this.next=function(){
var aK=ay[aW];
aX=aK.pos2+aK.len2-(aK.pos1+aK.len1);
aW++;
};
this.done=function(){return aW>=ay.length;};
this.TranslatePos=function(aE){return aE+aX;};
};
function ProcessInternals(aY){
aY.new_start_pos=aV.TranslatePos(
aY.info.start_position);
var aZ=0;
var ba=false;
var bb=false;
while(!aV.done()&&
aV.current().pos1<aY.info.end_position){
if(aZ<aY.children.length){
var bc=aY.children[aZ];
if(bc.info.end_position<=aV.current().pos1){
ProcessUnchangedChild(bc);
aZ++;
continue;
}else if(bc.info.start_position>=
aV.current().pos1+aV.current().len1){
ba=true;
aV.next();
continue;
}else if(bc.info.start_position<=aV.current().pos1&&
bc.info.end_position>=aV.current().pos1+
aV.current().len1){
ProcessInternals(bc);
bb=bb||
(bc.status!=i.UNCHANGED);
ba=ba||
(bc.status==i.DAMAGED);
aZ++;
continue;
}else{
ba=true;
bc.status=i.DAMAGED;
bc.status_explanation=
"Text diff overlaps with function boundary";
aZ++;
continue;
}
}else{
if(aV.current().pos1+aV.current().len1<=
aY.info.end_position){
aY.status=i.CHANGED;
aV.next();
continue;
}else{
aY.status=i.DAMAGED;
aY.status_explanation=
"Text diff overlaps with function boundary";
return;
}
}
Assert("Unreachable",false);
}
while(aZ<aY.children.length){
var bc=aY.children[aZ];
ProcessUnchangedChild(bc);
aZ++;
}
if(ba){
aY.status=i.CHANGED;
}else if(bb){
aY.status=i.SOURCE_CHANGED;
}
aY.new_end_pos=
aV.TranslatePos(aY.info.end_position);
}
function ProcessUnchangedChild(w){
w.new_start_pos=aV.TranslatePos(w.info.start_position);
w.new_end_pos=aV.TranslatePos(w.info.end_position);
}
ProcessInternals(aU);
}
function FindCorrespondingFunctions(bd,be){
function ProcessNode(v,bf){
var bg=
IsFunctionContextLocalsChanged(v.info,bf.info);
if(bg){
v.status=i.CHANGED;
}
var bh=v.children;
var bi=bf.children;
var bj=[];
var bk=[];
var bl=0;
var bm=0;
while(bl<bh.length){
if(bh[bl].status==i.DAMAGED){
bl++;
}else if(bm<bi.length){
if(bi[bm].info.start_position<
bh[bl].new_start_pos){
bj.push(bi[bm]);
bk.push(bi[bm]);
bm++;
}else if(bi[bm].info.start_position==
bh[bl].new_start_pos){
if(bi[bm].info.end_position==
bh[bl].new_end_pos){
bh[bl].corresponding_node=
bi[bm];
bh[bl].textual_corresponding_node=
bi[bm];
if(bg){
bh[bl].status=i.DAMAGED;
bh[bl].status_explanation=
"Enclosing function is now incompatible. "+
bg;
bh[bl].corresponding_node=(void 0);
}else if(bh[bl].status!=
i.UNCHANGED){
ProcessNode(bh[bl],
bi[bm]);
if(bh[bl].status==i.DAMAGED){
bj.push(
bh[bl].corresponding_node);
bh[bl].corresponding_node=(void 0);
v.status=i.CHANGED;
}
}
}else{
bh[bl].status=i.DAMAGED;
bh[bl].status_explanation=
"No corresponding function in new script found";
v.status=i.CHANGED;
bj.push(bi[bm]);
bk.push(bi[bm]);
}
bm++;
bl++;
}else{
bh[bl].status=i.DAMAGED;
bh[bl].status_explanation=
"No corresponding function in new script found";
v.status=i.CHANGED;
bl++;
}
}else{
bh[bl].status=i.DAMAGED;
bh[bl].status_explanation=
"No corresponding function in new script found";
v.status=i.CHANGED;
bl++;
}
}
while(bm<bi.length){
bj.push(bi[bm]);
bk.push(bi[bm]);
bm++;
}
if(v.status==i.CHANGED){
if(v.info.param_num!=bf.info.param_num){
v.status=i.DAMAGED;
v.status_explanation="Changed parameter number: "+
v.info.param_num+" and "+bf.info.param_num;
}
}
v.unmatched_new_nodes=bj;
v.textually_unmatched_new_nodes=
bk;
}
ProcessNode(bd,be);
bd.corresponding_node=be;
bd.textual_corresponding_node=be;
Assert(bd.status!=i.DAMAGED,
"Script became damaged");
}
function FindLiveSharedInfos(bd,N){
var bn=%LiveEditFindSharedFunctionInfosForScript(N);
var bo=new e();
for(var x=0;x<bn.length;x++){
bo.push(new SharedInfoWrapper(bn[x]));
}
function FindFunctionInfos(P){
var bp=[];
for(var x=0;x<bo.length;x++){
var bq=bo[x];
if(bq.start_position==P.start_position&&
bq.end_position==P.end_position){
bp.push(bq);
}
}
if(bp.length>0){
return bp;
}
}
function TraverseTree(w){
w.live_shared_function_infos=FindFunctionInfos(w.info);
for(var x=0;x<w.children.length;x++){
TraverseTree(w.children[x]);
}
}
TraverseTree(bd);
}
function FunctionCompileInfo(br){
this.function_name=br[0];
this.start_position=br[1];
this.end_position=br[2];
this.param_num=br[3];
this.code=br[4];
this.code_scope_info=br[5];
this.scope_info=br[6];
this.outer_index=br[7];
this.shared_function_info=br[8];
this.next_sibling_index=null;
this.raw_array=br;
}
function SharedInfoWrapper(br){
this.function_name=br[0];
this.start_position=br[1];
this.end_position=br[2];
this.info=br[3];
this.raw_array=br;
}
function PatchPositions(ad,ax,ae){
if(ad.live_shared_function_infos){
ad.live_shared_function_infos.forEach(function(L){
%LiveEditPatchFunctionPositions(L.raw_array,
ax);
});
ae.push({name:ad.info.function_name});
}else{
ae.push(
{name:ad.info.function_name,info_not_found:true});
}
}
function CreateNameForOldScript(N){
return N.name+" (old)";
}
function IsFunctionContextLocalsChanged(bs,bt){
var bu=bs.scope_info;
var bv=bt.scope_info;
var bw;
var bx;
if(bu){
bw=bu.toString();
}else{
bw="";
}
if(bv){
bx=bv.toString();
}else{
bx="";
}
if(bw!=bx){
return"Variable map changed: ["+bw+
"] => ["+bx+"]";
}
return;
}
var by;
function CheckStackActivations(old_shared_wrapper_list,
new_shared_list,
Z){
var bz=new e();
for(var x=0;x<old_shared_wrapper_list.length;x++){
bz[x]=old_shared_wrapper_list[x].info;
}
var bA=%LiveEditCheckAndDropActivations(
bz,new_shared_list,true);
if(bA[old_shared_wrapper_list.length]){
throw new Failure(bA[old_shared_wrapper_list.length]);
}
var bB=new e();
var bC=new e();
for(var x=0;x<bz.length;x++){
var bD=old_shared_wrapper_list[x];
if(bA[x]==by.REPLACED_ON_ACTIVE_STACK){
bC.push({name:bD.function_name});
}else if(bA[x]!=by.AVAILABLE_FOR_PATCH){
var bE={
name:bD.function_name,
start_pos:bD.start_position,
end_pos:bD.end_position,
replace_problem:
by.SymbolName(bA[x])
};
bB.push(bE);
}
}
if(bC.length>0){
Z.push({dropped_from_stack:bC});
}
if(bB.length>0){
Z.push({functions_on_stack:bB});
throw new Failure("Blocked by functions on stack");
}
return bC.length;
}
var by={
AVAILABLE_FOR_PATCH:1,
BLOCKED_ON_ACTIVE_STACK:2,
BLOCKED_ON_OTHER_STACK:3,
BLOCKED_UNDER_NATIVE_CODE:4,
REPLACED_ON_ACTIVE_STACK:5,
BLOCKED_UNDER_GENERATOR:6,
BLOCKED_ACTIVE_GENERATOR:7,
BLOCKED_NO_NEW_TARGET_ON_RESTART:8
};
by.SymbolName=function(bF){
var bG=by;
for(var bH in bG){
if(bG[bH]==bF){
return bH;
}
}
};
function Failure(as){
this.message=as;
}
Failure.prototype.toString=function(){
return"LiveEdit Failure: "+this.message;
};
function CopyErrorPositionToDetails(bI,p){
function createPositionStruct(N,bJ){
if(bJ==-1)return;
var bK=N.locationFromPosition(bJ,true);
if(bK==null)return;
return{
line:bK.line+1,
column:bK.column+1,
position:bJ
};
}
if(!("scriptObject"in bI)||!("startPosition"in bI)){
return;
}
var N=bI.scriptObject;
var bL={
start:createPositionStruct(N,bI.startPosition),
end:createPositionStruct(N,bI.endPosition)
};
p.position=bL;
}
function GetPcFromSourcePos(bM,bN){
return %GetFunctionCodePositionFromSource(bM,bN);
}
function SetScriptSource(N,bO,bP,Z){
var j=N.source;
var bQ=CompareStrings(j,bO);
return ApplyPatchMultiChunk(N,bQ,bO,bP,
Z);
}
function CompareStrings(bR,bS){
return %LiveEditCompareStrings(bR,bS);
}
function ApplySingleChunkPatch(N,change_pos,change_len,new_str,
Z){
var j=N.source;
var bO=j.substring(0,change_pos)+
new_str+j.substring(change_pos+change_len);
return ApplyPatchMultiChunk(N,
[change_pos,change_pos+change_len,change_pos+new_str.length],
bO,false,Z);
}
function DescribeChangeTree(bd){
function ProcessOldNode(w){
var bT=[];
for(var x=0;x<w.children.length;x++){
var bc=w.children[x];
if(bc.status!=i.UNCHANGED){
bT.push(ProcessOldNode(bc));
}
}
var bU=[];
if(w.textually_unmatched_new_nodes){
for(var x=0;x<w.textually_unmatched_new_nodes.length;x++){
var bc=w.textually_unmatched_new_nodes[x];
bU.push(ProcessNewNode(bc));
}
}
var bV={
name:w.info.function_name,
positions:DescribePositions(w),
status:w.status,
children:bT,
new_children:bU
};
if(w.status_explanation){
bV.status_explanation=w.status_explanation;
}
if(w.textual_corresponding_node){
bV.new_positions=DescribePositions(w.textual_corresponding_node);
}
return bV;
}
function ProcessNewNode(w){
var bT=[];
if(false){
for(var x=0;x<w.children.length;x++){
bT.push(ProcessNewNode(w.children[x]));
}
}
var bV={
name:w.info.function_name,
positions:DescribePositions(w),
children:bT,
};
return bV;
}
function DescribePositions(w){
return{
start_position:w.info.start_position,
end_position:w.info.end_position
};
}
return ProcessOldNode(bd);
}
var bW={};
bW.SetScriptSource=SetScriptSource;
bW.ApplyPatchMultiChunk=ApplyPatchMultiChunk;
bW.Failure=Failure;
bW.GetPcFromSourcePos=GetPcFromSourcePos;
bW.TestApi={
PosTranslator:PosTranslator,
CompareStrings:CompareStrings,
ApplySingleChunkPatch:ApplySingleChunkPatch
};
a.Debug.LiveEdit=bW;
})

h prologueK
(function(a,b,c){
"use strict";
%CheckIsBootstrapping();
var d=(void 0);
var e=(void 0);
var f=%ExportFromRuntime({});
var g=(void 0);
function SetupTypedArray(h){
h.next=g;
g=h;
}
function Export(h){
h(f);
}
function Import(h){
h.next=d;
d=h;
}
function ImportNow(i){
return f[i];
}
function ImportFromExperimental(h){
h.next=e;
e=h;
}
function SetFunctionName(h,i,j){
if((typeof(i)==='symbol')){
i="["+%SymbolDescription(i)+"]";
}
if((j===(void 0))){
%FunctionSetName(h,i);
}else{
%FunctionSetName(h,j+" "+i);
}
}
function InstallConstants(k,l){
%CheckIsBootstrapping();
%OptimizeObjectForAddingMultipleProperties(k,l.length>>1);
var m=2|4|1;
for(var n=0;n<l.length;n+=2){
var i=l[n];
var o=l[n+1];
%AddNamedProperty(k,i,o,m);
}
%ToFastProperties(k);
}
function InstallFunctions(k,m,p){
%CheckIsBootstrapping();
%OptimizeObjectForAddingMultipleProperties(k,p.length>>1);
for(var n=0;n<p.length;n+=2){
var q=p[n];
var h=p[n+1];
SetFunctionName(h,q);
%FunctionRemovePrototype(h);
%AddNamedProperty(k,q,h,m);
%SetNativeFlag(h);
}
%ToFastProperties(k);
}
function InstallGetter(k,i,r,m,j){
%CheckIsBootstrapping();
if((m===(void 0)))m=2;
SetFunctionName(r,i,(j===(void 0))?"get":j);
%FunctionRemovePrototype(r);
%DefineGetterPropertyUnchecked(k,i,r,m);
%SetNativeFlag(r);
}
function InstallGetterSetter(k,i,r,s,m){
%CheckIsBootstrapping();
if((m===(void 0)))m=2;
SetFunctionName(r,i,"get");
SetFunctionName(s,i,"set");
%FunctionRemovePrototype(r);
%FunctionRemovePrototype(s);
%DefineAccessorPropertyUnchecked(k,i,r,s,2);
%SetNativeFlag(r);
%SetNativeFlag(s);
}
function SetUpLockedPrototype(
constructor,fields,methods){
%CheckIsBootstrapping();
var t=constructor.prototype;
var u=(methods.length>>1)+(fields?fields.length:0);
if(u>=4){
%OptimizeObjectForAddingMultipleProperties(t,u);
}
if(fields){
for(var n=0;n<fields.length;n++){
%AddNamedProperty(t,fields[n],
(void 0),2|4);
}
}
for(var n=0;n<methods.length;n+=2){
var q=methods[n];
var h=methods[n+1];
%AddNamedProperty(t,q,h,2|4|1);
%SetNativeFlag(h);
}
%InternalSetPrototype(t,null);
%ToFastProperties(t);
}
function PostNatives(b){
%CheckIsBootstrapping();
for(;!(d===(void 0));d=d.next){
d(f);
}
var v=[
"ArrayToString",
"ErrorToString",
"GetIterator",
"GetMethod",
"IsNaN",
"MakeError",
"MakeTypeError",
"MapEntries",
"MapIterator",
"MapIteratorNext",
"MathMax",
"MathMin",
"MaxSimple",
"MinSimple",
"ObjectDefineProperty",
"ObserveArrayMethods",
"ObserveObjectMethods",
"PromiseChain",
"PromiseDeferred",
"PromiseResolved",
"SameValueZero",
"SetIterator",
"SetIteratorNext",
"SetValues",
"SymbolToString",
"ToPositiveInteger",
"is_concat_spreadable_symbol",
"iterator_symbol",
"promise_status_symbol",
"promise_value_symbol",
"object_freeze",
"object_is_frozen",
"object_is_sealed",
"reflect_apply",
"reflect_construct",
"regexp_flags_symbol",
"to_string_tag_symbol",
"object_to_string",
"species_symbol",
];
var w={};
%OptimizeObjectForAddingMultipleProperties(
w,v.length);
for(var q of v){
w[q]=f[q];
}
%ToFastProperties(w);
f=w;
b.PostNatives=(void 0);
b.ImportFromExperimental=(void 0);
}
function PostExperimentals(b){
%CheckIsBootstrapping();
%ExportExperimentalFromRuntime(f);
for(;!(d===(void 0));d=d.next){
d(f);
}
for(;!(e===(void 0));
e=e.next){
e(f);
}
b.CreateDoubleResultArray();
b.CreateDoubleResultArray=(void 0);
b.Export=(void 0);
b.PostDebug=(void 0);
b.PostExperimentals=(void 0);
g=(void 0);
}
function PostDebug(b){
for(;!(d===(void 0));d=d.next){
d(f);
}
b.CreateDoubleResultArray();
b.CreateDoubleResultArray=(void 0);
f=(void 0);
b.Export=(void 0);
b.Import=(void 0);
b.ImportNow=(void 0);
b.PostDebug=(void 0);
b.PostExperimentals=(void 0);
g=(void 0);
}
function InitializeBuiltinTypedArrays(b,x,y){
var z=g;
for(;!(z===(void 0));z=z.next){
z(x,y);
}
}
%OptimizeObjectForAddingMultipleProperties(b,14);
b.Import=Import;
b.ImportNow=ImportNow;
b.Export=Export;
b.ImportFromExperimental=ImportFromExperimental;
b.SetFunctionName=SetFunctionName;
b.InstallConstants=InstallConstants;
b.InstallFunctions=InstallFunctions;
b.InstallGetter=InstallGetter;
b.InstallGetterSetter=InstallGetterSetter;
b.SetUpLockedPrototype=SetUpLockedPrototype;
b.PostNatives=PostNatives;
b.PostExperimentals=PostExperimentals;
b.PostDebug=PostDebug;
%ToFastProperties(b);
%OptimizeObjectForAddingMultipleProperties(c,5);
c.logStackTrace=function logStackTrace(){
%DebugTrace();
};
c.log=function log(){
let message='';
for(const arg of arguments){
message+=arg;
}
%GlobalPrint(message);
};
c.createPrivateSymbol=function createPrivateSymbol(i){
return %CreatePrivateSymbol(i);
};
c.simpleBind=function simpleBind(A,B){
return function(){
return %Apply(A,B,arguments,0,arguments.length);
};
};
c.uncurryThis=function uncurryThis(A){
return function(B){
return %Apply(A,B,arguments,1,arguments.length-1);
};
};
%ToFastProperties(c);
})

runtime9"
(function(a,b){
%CheckIsBootstrapping();
var c;
var d=a.Array;
var e=a.Boolean;
var f=a.String;
var g;
var h;
var i;
b.Import(function(j){
g=j.MakeRangeError;
h=j.MakeTypeError;
i=j.species_symbol;
});
b.ImportFromExperimental(function(j){
c=j.FLAG_harmony_species;
});
function CONCAT_ITERABLE_TO_ARRAY(k){
return %concat_iterable_to_array(this,k);
};
function SameValue(l,m){
if(typeof l!=typeof m)return false;
if((typeof(l)==='number')){
if((!%_IsSmi(%IS_VAR(l))&&!(l==l))&&(!%_IsSmi(%IS_VAR(m))&&!(m==m)))return true;
if(l===0&&m===0&&%_IsMinusZero(l)!=%_IsMinusZero(m)){
return false;
}
}
if((%_IsSimdValue(l)))return %SimdSameValue(l,m);
return l===m;
}
function SameValueZero(l,m){
if(typeof l!=typeof m)return false;
if((typeof(l)==='number')){
if((!%_IsSmi(%IS_VAR(l))&&!(l==l))&&(!%_IsSmi(%IS_VAR(m))&&!(m==m)))return true;
}
if((%_IsSimdValue(l)))return %SimdSameValueZero(l,m);
return l===m;
}
function ConcatIterableToArray(n,k){
var o=n.length;
for(var p of k){
AddIndexedProperty(n,o++,p);
}
return n;
}
function AddIndexedProperty(q,o,r){
if(o===((o)>>>0)&&o!==4294967295){
%AddElement(q,o,r);
}else{
%AddNamedProperty(q,(%_ToString(o)),r,0);
}
}
%SetForceInlineFlag(AddIndexedProperty);
function ToPositiveInteger(l,s){
var t=(%_IsSmi(%IS_VAR(l))?l:%NumberToIntegerMapMinusZero(l));
if(t<0)throw g(s);
return t;
}
function MaxSimple(u,v){
return u>v?u:v;
}
function MinSimple(u,v){
return u>v?v:u;
}
%SetForceInlineFlag(MaxSimple);
%SetForceInlineFlag(MinSimple);
function SpeciesConstructor(w,x,y){
if(c){
var z=w.constructor;
if((z===(void 0))){
return x;
}
if(!(%_IsJSReceiver(z))){
throw h(27);
}
var A=z[i];
if((A==null)){
return x;
}
if(%IsConstructor(A)){
return A;
}
throw h(235);
}else{
return y?x:w.constructor;
}
}
%FunctionSetPrototype(d,new d(0));
b.Export(function(B){
B.AddIndexedProperty=AddIndexedProperty;
B.MaxSimple=MaxSimple;
B.MinSimple=MinSimple;
B.SameValue=SameValue;
B.SameValueZero=SameValueZero;
B.ToPositiveInteger=ToPositiveInteger;
B.SpeciesConstructor=SpeciesConstructor;
});
%InstallToContext([
"concat_iterable_to_array_builtin",CONCAT_ITERABLE_TO_ARRAY,
]);
%InstallToContext([
"concat_iterable_to_array",ConcatIterableToArray,
]);
})

$v8nativesÚ#
(function(a,b){
%CheckIsBootstrapping();
var c=a.Array;
var d=a.Boolean;
var e=a.Number;
var f=a.Object;
var g=b.InternalArray;
var h=b.ImportNow("iterator_symbol");
var i;
var j;
var k;
var l;
var m=%GetRootNaN();
var n=b.ImportNow("object_to_string");
var o;
var p;
var q;
var r=b.ImportNow("SameValue");
var s=b.ImportNow("to_string_tag_symbol");
b.Import(function(t){
i=t.MakeRangeError;
j=t.MakeSyntaxError;
k=t.MakeTypeError;
l=t.MathAbs;
o=t.ObserveBeginPerformSplice;
p=t.ObserveEndPerformSplice;
q=t.ObserveEnqueueSpliceRecord;
});
function GlobalIsNaN(u){
u=(%_ToNumber(u));
return(!%_IsSmi(%IS_VAR(u))&&!(u==u));
}
function GlobalIsFinite(u){
u=(%_ToNumber(u));
return(%_IsSmi(%IS_VAR(u))||((u==u)&&(u!=1/0)&&(u!=-1/0)));
}
function GlobalParseInt(v,w){
if((w===(void 0))||w===10||w===0){
if(%_IsSmi(v))return v;
if((typeof(v)==='number')&&
((0.01<v&&v<1e9)||
(-1e9<v&&v<-0.01))){
return v|0;
}
v=(%_ToString(v));
w=w|0;
}else{
v=(%_ToString(v));
w=((w)|0);
if(!(w==0||(2<=w&&w<=36))){
return m;
}
}
if(%_HasCachedArrayIndex(v)&&
(w==0||w==10)){
return %_GetCachedArrayIndex(v);
}
return %StringParseInt(v,w);
}
function GlobalParseFloat(v){
v=(%_ToString(v));
if(%_HasCachedArrayIndex(v))return %_GetCachedArrayIndex(v);
return %StringParseFloat(v);
}
var x=2|4|1;
b.InstallConstants(a,[
"Infinity",(1/0),
"NaN",m,
"undefined",(void 0),
]);
b.InstallFunctions(a,2,[
"isNaN",GlobalIsNaN,
"isFinite",GlobalIsFinite,
"parseInt",GlobalParseInt,
"parseFloat",GlobalParseFloat,
]);
function ObjectToLocaleString(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw k(17,"Object.prototype.toLocaleString");
return this.toString();
}
function ObjectValueOf(){
return(%_ToObject(this));
}
function ObjectHasOwnProperty(y){
var z=(%_ToName(y));
var A=(%_ToObject(this));
return %HasOwnProperty(A,z);
}
function ObjectIsPrototypeOf(B){
if(!(%_IsJSReceiver(B)))return false;
var C=(%_ToObject(this));
return %HasInPrototypeChain(B,C);
}
function ObjectPropertyIsEnumerable(B){
var D=(%_ToName(B));
return %PropertyIsEnumerable((%_ToObject(this)),D);
}
function ObjectDefineGetter(z,E){
var F=this;
if((F===null)||(F===(void 0))){
F=%GlobalProxy(ObjectDefineGetter);
}
if(!(typeof(E)==='function')){
throw k(72);
}
var G=new PropertyDescriptor();
G.setGet(E);
G.setEnumerable(true);
G.setConfigurable(true);
DefineOwnProperty((%_ToObject(F)),(%_ToName(z)),G,false);
}
function ObjectLookupGetter(z){
var F=this;
if((F===null)||(F===(void 0))){
F=%GlobalProxy(ObjectLookupGetter);
}
return %LookupAccessor((%_ToObject(F)),(%_ToName(z)),0);
}
function ObjectDefineSetter(z,E){
var F=this;
if((F===null)||(F===(void 0))){
F=%GlobalProxy(ObjectDefineSetter);
}
if(!(typeof(E)==='function')){
throw k(75);
}
var G=new PropertyDescriptor();
G.setSet(E);
G.setEnumerable(true);
G.setConfigurable(true);
DefineOwnProperty((%_ToObject(F)),(%_ToName(z)),G,false);
}
function ObjectLookupSetter(z){
var F=this;
if((F===null)||(F===(void 0))){
F=%GlobalProxy(ObjectLookupSetter);
}
return %LookupAccessor((%_ToObject(F)),(%_ToName(z)),1);
}
function IsAccessorDescriptor(G){
if((G===(void 0)))return false;
return G.hasGetter()||G.hasSetter();
}
function IsDataDescriptor(G){
if((G===(void 0)))return false;
return G.hasValue()||G.hasWritable();
}
function IsGenericDescriptor(G){
if((G===(void 0)))return false;
return!(IsAccessorDescriptor(G)||IsDataDescriptor(G));
}
function IsInconsistentDescriptor(G){
return IsAccessorDescriptor(G)&&IsDataDescriptor(G);
}
function FromGenericPropertyDescriptor(G){
if((G===(void 0)))return G;
var H=new f();
if(G.hasValue()){
%AddNamedProperty(H,"value",G.getValue(),0);
}
if(G.hasWritable()){
%AddNamedProperty(H,"writable",G.isWritable(),0);
}
if(G.hasGetter()){
%AddNamedProperty(H,"get",G.getGet(),0);
}
if(G.hasSetter()){
%AddNamedProperty(H,"set",G.getSet(),0);
}
if(G.hasEnumerable()){
%AddNamedProperty(H,"enumerable",G.isEnumerable(),0);
}
if(G.hasConfigurable()){
%AddNamedProperty(H,"configurable",G.isConfigurable(),0);
}
return H;
}
function ToPropertyDescriptor(H){
if(!(%_IsJSReceiver(H)))throw k(90,H);
var G=new PropertyDescriptor();
if("enumerable"in H){
G.setEnumerable((!!(H.enumerable)));
}
if("configurable"in H){
G.setConfigurable((!!(H.configurable)));
}
if("value"in H){
G.setValue(H.value);
}
if("writable"in H){
G.setWritable((!!(H.writable)));
}
if("get"in H){
var I=H.get;
if(!(I===(void 0))&&!(typeof(I)==='function')){
throw k(73,I);
}
G.setGet(I);
}
if("set"in H){
var J=H.set;
if(!(J===(void 0))&&!(typeof(J)==='function')){
throw k(76,J);
}
G.setSet(J);
}
if(IsInconsistentDescriptor(G)){
throw k(153,H);
}
return G;
}
function ToCompletePropertyDescriptor(H){
var G=ToPropertyDescriptor(H);
if(IsGenericDescriptor(G)||IsDataDescriptor(G)){
if(!G.hasValue())G.setValue((void 0));
if(!G.hasWritable())G.setWritable(false);
}else{
if(!G.hasGetter())G.setGet((void 0));
if(!G.hasSetter())G.setSet((void 0));
}
if(!G.hasEnumerable())G.setEnumerable(false);
if(!G.hasConfigurable())G.setConfigurable(false);
return G;
}
function PropertyDescriptor(){
this.value_=(void 0);
this.hasValue_=false;
this.writable_=false;
this.hasWritable_=false;
this.enumerable_=false;
this.hasEnumerable_=false;
this.configurable_=false;
this.hasConfigurable_=false;
this.get_=(void 0);
this.hasGetter_=false;
this.set_=(void 0);
this.hasSetter_=false;
}
b.SetUpLockedPrototype(PropertyDescriptor,[
"value_",
"hasValue_",
"writable_",
"hasWritable_",
"enumerable_",
"hasEnumerable_",
"configurable_",
"hasConfigurable_",
"get_",
"hasGetter_",
"set_",
"hasSetter_"
],[
"toString",function PropertyDescriptor_ToString(){
return"[object PropertyDescriptor]";
},
"setValue",function PropertyDescriptor_SetValue(y){
this.value_=y;
this.hasValue_=true;
},
"getValue",function PropertyDescriptor_GetValue(){
return this.value_;
},
"hasValue",function PropertyDescriptor_HasValue(){
return this.hasValue_;
},
"setEnumerable",function PropertyDescriptor_SetEnumerable(K){
this.enumerable_=K;
this.hasEnumerable_=true;
},
"isEnumerable",function PropertyDescriptor_IsEnumerable(){
return this.enumerable_;
},
"hasEnumerable",function PropertyDescriptor_HasEnumerable(){
return this.hasEnumerable_;
},
"setWritable",function PropertyDescriptor_SetWritable(L){
this.writable_=L;
this.hasWritable_=true;
},
"isWritable",function PropertyDescriptor_IsWritable(){
return this.writable_;
},
"hasWritable",function PropertyDescriptor_HasWritable(){
return this.hasWritable_;
},
"setConfigurable",
function PropertyDescriptor_SetConfigurable(M){
this.configurable_=M;
this.hasConfigurable_=true;
},
"hasConfigurable",function PropertyDescriptor_HasConfigurable(){
return this.hasConfigurable_;
},
"isConfigurable",function PropertyDescriptor_IsConfigurable(){
return this.configurable_;
},
"setGet",function PropertyDescriptor_SetGetter(I){
this.get_=I;
this.hasGetter_=true;
},
"getGet",function PropertyDescriptor_GetGetter(){
return this.get_;
},
"hasGetter",function PropertyDescriptor_HasGetter(){
return this.hasGetter_;
},
"setSet",function PropertyDescriptor_SetSetter(J){
this.set_=J;
this.hasSetter_=true;
},
"getSet",function PropertyDescriptor_GetSetter(){
return this.set_;
},
"hasSetter",function PropertyDescriptor_HasSetter(){
return this.hasSetter_;
}
]);
function ConvertDescriptorArrayToDescriptor(N){
if((N===(void 0))){
return(void 0);
}
var G=new PropertyDescriptor();
if(N[0]){
G.setGet(N[2]);
G.setSet(N[3]);
}else{
G.setValue(N[1]);
G.setWritable(N[4]);
}
G.setEnumerable(N[5]);
G.setConfigurable(N[6]);
return G;
}
function GetTrap(O,z,P){
var Q=O[z];
if((Q===(void 0))){
if((P===(void 0))){
throw k(41);
}
Q=P;
}else if(!(typeof(Q)==='function')){
throw k(41);
}
return Q;
}
function CallTrap1(O,z,P,R){
return %_Call(GetTrap(O,z,P),O,R);
}
function CallTrap2(O,z,P,R,S){
return %_Call(GetTrap(O,z,P),O,R,S);
}
function GetOwnPropertyJS(H,T){
var U=(%_ToName(T));
if((%_IsJSProxy(H))){
if((typeof(T)==='symbol'))return(void 0);
var O=%JSProxyGetHandler(H);
var V=CallTrap1(
O,"getOwnPropertyDescriptor",(void 0),U);
if((V===(void 0)))return V;
var G=ToCompletePropertyDescriptor(V);
if(!G.isConfigurable()){
throw k(41);
}
return G;
}
var W=%GetOwnProperty_Legacy((%_ToObject(H)),U);
return ConvertDescriptorArrayToDescriptor(W);
}
function GetMethod(H,U){
var X=H[U];
if((X==null))return(void 0);
if((typeof(X)==='function'))return X;
throw k(15,typeof X);
}
function DefineProxyProperty(H,U,x,Y){
if((typeof(U)==='symbol'))return false;
var O=%JSProxyGetHandler(H);
var Z=CallTrap2(O,"defineProperty",(void 0),U,x);
if(!Z){
if(Y){
throw k(41);
}else{
return false;
}
}
return true;
}
function DefineObjectProperty(H,U,G,Y){
var aa=%GetOwnProperty_Legacy(H,(%_ToName(U)));
var ab=ConvertDescriptorArrayToDescriptor(aa);
var ac=%object_is_extensible(H);
if((ab===(void 0))&&!ac){
if(Y){
throw k(34,U);
}else{
return false;
}
}
if(!(ab===(void 0))){
if((IsGenericDescriptor(G)||
IsDataDescriptor(G)==IsDataDescriptor(ab))&&
(!G.hasEnumerable()||
r(G.isEnumerable(),ab.isEnumerable()))&&
(!G.hasConfigurable()||
r(G.isConfigurable(),ab.isConfigurable()))&&
(!G.hasWritable()||
r(G.isWritable(),ab.isWritable()))&&
(!G.hasValue()||
r(G.getValue(),ab.getValue()))&&
(!G.hasGetter()||
r(G.getGet(),ab.getGet()))&&
(!G.hasSetter()||
r(G.getSet(),ab.getSet()))){
return true;
}
if(!ab.isConfigurable()){
if(G.isConfigurable()||
(G.hasEnumerable()&&
G.isEnumerable()!=ab.isEnumerable())){
if(Y){
throw k(126,U);
}else{
return false;
}
}
if(!IsGenericDescriptor(G)){
if(IsDataDescriptor(ab)!=IsDataDescriptor(G)){
if(Y){
throw k(126,U);
}else{
return false;
}
}
if(IsDataDescriptor(ab)&&IsDataDescriptor(G)){
var ad=ab.isWritable();
if(ad!=G.isWritable()){
if(!ad||(%IsStrong(H))){
if(Y){
throw ad
?k(146,H,U)
:k(126,U);
}else{
return false;
}
}
}
if(!ad&&G.hasValue()&&
!r(G.getValue(),ab.getValue())){
if(Y){
throw k(126,U);
}else{
return false;
}
}
}
if(IsAccessorDescriptor(G)&&IsAccessorDescriptor(ab)){
if(G.hasSetter()&&
!r(G.getSet(),ab.getSet())){
if(Y){
throw k(126,U);
}else{
return false;
}
}
if(G.hasGetter()&&!r(G.getGet(),ab.getGet())){
if(Y){
throw k(126,U);
}else{
return false;
}
}
}
}
}
}
var ae=0;
if(G.hasEnumerable()){
ae|=G.isEnumerable()?0:2;
}else if(!(ab===(void 0))){
ae|=ab.isEnumerable()?0:2;
}else{
ae|=2;
}
if(G.hasConfigurable()){
ae|=G.isConfigurable()?0:4;
}else if(!(ab===(void 0))){
ae|=ab.isConfigurable()?0:4;
}else
ae|=4;
if(IsDataDescriptor(G)||
(IsGenericDescriptor(G)&&
((ab===(void 0))||IsDataDescriptor(ab)))){
if(G.hasWritable()){
ae|=G.isWritable()?0:1;
}else if(!(ab===(void 0))){
ae|=ab.isWritable()?0:1;
}else{
ae|=1;
}
var y=(void 0);
if(G.hasValue()){
y=G.getValue();
}else if(!(ab===(void 0))&&IsDataDescriptor(ab)){
y=ab.getValue();
}
%DefineDataPropertyUnchecked(H,U,y,ae);
}else{
var af=null;
if(G.hasGetter()){
af=G.getGet();
}else if(IsAccessorDescriptor(ab)&&ab.hasGetter()){
af=ab.getGet();
}
var ag=null;
if(G.hasSetter()){
ag=G.getSet();
}else if(IsAccessorDescriptor(ab)&&ab.hasSetter()){
ag=ab.getSet();
}
%DefineAccessorPropertyUnchecked(H,U,af,ag,ae);
}
return true;
}
function DefineArrayProperty(H,U,G,Y){
if(!(typeof(U)==='symbol')){
var ah=((U)>>>0);
var ai=false;
if((%_ToString(ah))==U&&ah!=4294967295){
var aj=H.length;
if(ah>=aj&&%IsObserved(H)){
ai=true;
o(H);
}
var ak=GetOwnPropertyJS(H,"length");
if((ah>=aj&&!ak.isWritable())||
!DefineObjectProperty(H,U,G,true)){
if(ai)
p(H);
if(Y){
throw k(34,U);
}else{
return false;
}
}
if(ah>=aj){
H.length=ah+1;
}
if(ai){
p(H);
q(H,aj,[],ah+1-aj);
}
return true;
}
}
return DefineObjectProperty(H,U,G,Y);
}
function DefineOwnProperty(H,U,G,Y){
if((%_IsJSProxy(H))){
if((typeof(U)==='symbol'))return false;
var x=FromGenericPropertyDescriptor(G);
return DefineProxyProperty(H,U,x,Y);
}else if((%_IsArray(H))){
return DefineArrayProperty(H,U,G,Y);
}else{
return DefineObjectProperty(H,U,G,Y);
}
}
function ObjectGetPrototypeOf(H){
return %_GetPrototype((%_ToObject(H)));
}
function ObjectSetPrototypeOf(H,al){
if((%IS_VAR(H)===null)||(H===(void 0)))throw k(17,"Object.setPrototypeOf");
if(al!==null&&!(%_IsJSReceiver(al))){
throw k(92,al);
}
if((%_IsJSReceiver(H))){
%SetPrototype(H,al);
}
return H;
}
function ObjectGetOwnPropertyDescriptor(H,U){
return %GetOwnProperty(H,U);
}
function ObjectGetOwnPropertyNames(H){
H=(%_ToObject(H));
return %GetOwnPropertyKeys(H,16);
}
function ObjectDefineProperty(H,U,x){
if(%IsObserved(H)){
if(!(%_IsJSReceiver(H))){
throw k(16,"Object.defineProperty");
}
var z=(%_ToName(U));
var G=ToPropertyDescriptor(x);
DefineOwnProperty(H,z,G,true);
return H;
}
return %ObjectDefineProperty(H,U,x);
}
function GetOwnEnumerablePropertyNames(A){
return %GetOwnPropertyKeys(A,2);
}
function ObjectDefineProperties(H,am){
if(%IsObserved(H)){
if(!(%_IsJSReceiver(H))){
throw k(16,"Object.defineProperties");
}
var W=(%_ToObject(am));
var an=GetOwnEnumerablePropertyNames(W);
var ao=new g();
for(var ap=0;ap<an.length;ap++){
ao.push(ToPropertyDescriptor(W[an[ap]]));
}
for(var ap=0;ap<an.length;ap++){
DefineOwnProperty(H,an[ap],ao[ap],true);
}
return H;
}
return %ObjectDefineProperties(H,am);
}
function ObjectGetProto(){
return %_GetPrototype((%_ToObject(this)));
}
function ObjectSetProto(al){
if((%IS_VAR(this)===null)||(this===(void 0)))throw k(17,"Object.prototype.__proto__");
if(((%_IsJSReceiver(al))||(al===null))&&(%_IsJSReceiver(this))){
%SetPrototype(this,al);
}
}
function ObjectConstructor(R){
if(f!=new.target&&!(new.target===(void 0))){
return this;
}
if((R===null)||(R===(void 0)))return{};
return(%_ToObject(R));
}
%SetNativeFlag(f);
%SetCode(f,ObjectConstructor);
%AddNamedProperty(f.prototype,"constructor",f,
2);
b.InstallFunctions(f.prototype,2,[
"toString",n,
"toLocaleString",ObjectToLocaleString,
"valueOf",ObjectValueOf,
"hasOwnProperty",ObjectHasOwnProperty,
"isPrototypeOf",ObjectIsPrototypeOf,
"propertyIsEnumerable",ObjectPropertyIsEnumerable,
"__defineGetter__",ObjectDefineGetter,
"__lookupGetter__",ObjectLookupGetter,
"__defineSetter__",ObjectDefineSetter,
"__lookupSetter__",ObjectLookupSetter
]);
b.InstallGetterSetter(f.prototype,"__proto__",ObjectGetProto,
ObjectSetProto);
b.InstallFunctions(f,2,[
"defineProperty",ObjectDefineProperty,
"defineProperties",ObjectDefineProperties,
"getPrototypeOf",ObjectGetPrototypeOf,
"setPrototypeOf",ObjectSetPrototypeOf,
"getOwnPropertyDescriptor",ObjectGetOwnPropertyDescriptor,
"getOwnPropertyNames",ObjectGetOwnPropertyNames,
"is",r,
]);
function BooleanConstructor(R){
"use strict";
if(!(new.target===(void 0))){
%_SetValueOf(this,(!!(R)));
}else{
return(!!(R));
}
}
function BooleanToString(){
var aq=this;
if(!(typeof(aq)==='boolean')){
if(!(%_ClassOf(aq)==='Boolean')){
throw k(65,'Boolean.prototype.toString');
}
aq=%_ValueOf(aq);
}
return aq?'true':'false';
}
function BooleanValueOf(){
if(!(typeof(this)==='boolean')&&!(%_ClassOf(this)==='Boolean')){
throw k(65,'Boolean.prototype.valueOf');
}
return %_ValueOf(this);
}
%SetCode(d,BooleanConstructor);
%FunctionSetPrototype(d,new d(false));
%AddNamedProperty(d.prototype,"constructor",d,
2);
b.InstallFunctions(d.prototype,2,[
"toString",BooleanToString,
"valueOf",BooleanValueOf
]);
function NumberToStringJS(w){
var u=this;
if(!(typeof(this)==='number')){
if(!(%_ClassOf(this)==='Number')){
throw k(65,'Number.prototype.toString');
}
u=%_ValueOf(this);
}
if((w===(void 0))||w===10){
return %_NumberToString(u);
}
w=(%_ToInteger(w));
if(w<2||w>36)throw i(189);
return %NumberToRadixString(u,w);
}
function NumberToLocaleString(){
return %_Call(NumberToStringJS,this);
}
function NumberValueOf(){
if(!(typeof(this)==='number')&&!(%_ClassOf(this)==='Number')){
throw k(65,'Number.prototype.valueOf');
}
return %_ValueOf(this);
}
function NumberToFixedJS(ar){
var R=this;
if(!(typeof(this)==='number')){
if(!(%_ClassOf(this)==='Number')){
throw k(42,
"Number.prototype.toFixed",this);
}
R=%_ValueOf(this);
}
var as=(%_ToInteger(ar));
if(as<0||as>20){
throw i(185,"toFixed() digits");
}
if((!%_IsSmi(%IS_VAR(R))&&!(R==R)))return"NaN";
if(R==(1/0))return"Infinity";
if(R==-(1/0))return"-Infinity";
return %NumberToFixed(R,as);
}
function NumberToExponentialJS(ar){
var R=this;
if(!(typeof(this)==='number')){
if(!(%_ClassOf(this)==='Number')){
throw k(42,
"Number.prototype.toExponential",this);
}
R=%_ValueOf(this);
}
var as=(ar===(void 0))?(void 0):(%_ToInteger(ar));
if((!%_IsSmi(%IS_VAR(R))&&!(R==R)))return"NaN";
if(R==(1/0))return"Infinity";
if(R==-(1/0))return"-Infinity";
if((as===(void 0))){
as=-1;
}else if(as<0||as>20){
throw i(185,"toExponential()");
}
return %NumberToExponential(R,as);
}
function NumberToPrecisionJS(at){
var R=this;
if(!(typeof(this)==='number')){
if(!(%_ClassOf(this)==='Number')){
throw k(42,
"Number.prototype.toPrecision",this);
}
R=%_ValueOf(this);
}
if((at===(void 0)))return(%_ToString(R));
var U=(%_ToInteger(at));
if((!%_IsSmi(%IS_VAR(R))&&!(R==R)))return"NaN";
if(R==(1/0))return"Infinity";
if(R==-(1/0))return"-Infinity";
if(U<1||U>21){
throw i(188);
}
return %NumberToPrecision(R,U);
}
function NumberIsFinite(u){
return(typeof(u)==='number')&&(%_IsSmi(%IS_VAR(u))||((u==u)&&(u!=1/0)&&(u!=-1/0)));
}
function NumberIsInteger(u){
return NumberIsFinite(u)&&(%_ToInteger(u))==u;
}
function NumberIsNaN(u){
return(typeof(u)==='number')&&(!%_IsSmi(%IS_VAR(u))&&!(u==u));
}
function NumberIsSafeInteger(u){
if(NumberIsFinite(u)){
var au=(%_ToInteger(u));
if(au==u){
return l(au)<=9007199254740991;
}
}
return false;
}
%FunctionSetPrototype(e,new e(0));
%OptimizeObjectForAddingMultipleProperties(e.prototype,8);
%AddNamedProperty(e.prototype,"constructor",e,
2);
b.InstallConstants(e,[
"MAX_VALUE",1.7976931348623157e+308,
"MIN_VALUE",5e-324,
"NaN",m,
"NEGATIVE_INFINITY",-(1/0),
"POSITIVE_INFINITY",(1/0),
"MAX_SAFE_INTEGER",%_MathPow(2,53)-1,
"MIN_SAFE_INTEGER",-%_MathPow(2,53)+1,
"EPSILON",%_MathPow(2,-52)
]);
b.InstallFunctions(e.prototype,2,[
"toString",NumberToStringJS,
"toLocaleString",NumberToLocaleString,
"valueOf",NumberValueOf,
"toFixed",NumberToFixedJS,
"toExponential",NumberToExponentialJS,
"toPrecision",NumberToPrecisionJS
]);
b.InstallFunctions(e,2,[
"isFinite",NumberIsFinite,
"isInteger",NumberIsInteger,
"isNaN",NumberIsNaN,
"isSafeInteger",NumberIsSafeInteger,
"parseInt",GlobalParseInt,
"parseFloat",GlobalParseFloat
]);
%SetForceInlineFlag(NumberIsNaN);
function GetIterator(H,av){
if((av===(void 0))){
av=H[h];
}
if(!(typeof(av)==='function')){
throw k(66,H);
}
var aw=%_Call(av,H);
if(!(%_IsJSReceiver(aw))){
throw k(60,aw);
}
return aw;
}
b.Export(function(ax){
ax.GetIterator=GetIterator;
ax.GetMethod=GetMethod;
ax.IsFinite=GlobalIsFinite;
ax.IsNaN=GlobalIsNaN;
ax.NumberIsNaN=NumberIsNaN;
ax.ObjectDefineProperties=ObjectDefineProperties;
ax.ObjectDefineProperty=ObjectDefineProperty;
ax.ObjectHasOwnProperty=ObjectHasOwnProperty;
});
%InstallToContext([
"object_value_of",ObjectValueOf,
]);
})

symbol9
(function(a,b){
"use strict";
%CheckIsBootstrapping();
var c=a.Object;
var d=a.Symbol;
var e=b.ImportNow("has_instance_symbol");
var f=
b.ImportNow("is_concat_spreadable_symbol");
var g=b.ImportNow("iterator_symbol");
var h;
var i=b.ImportNow("to_primitive_symbol");
var j=b.ImportNow("to_string_tag_symbol");
var k=b.ImportNow("unscopables_symbol");
b.Import(function(l){
h=l.MakeTypeError;
});
function SymbolToPrimitive(m){
if(!((typeof(this)==='symbol')||(%_ClassOf(this)==='Symbol'))){
throw h(42,
"Symbol.prototype [ @@toPrimitive ]",this);
}
return %_ValueOf(this);
}
function SymbolToString(){
if(!((typeof(this)==='symbol')||(%_ClassOf(this)==='Symbol'))){
throw h(42,
"Symbol.prototype.toString",this);
}
return %SymbolDescriptiveString(%_ValueOf(this));
}
function SymbolValueOf(){
if(!((typeof(this)==='symbol')||(%_ClassOf(this)==='Symbol'))){
throw h(42,
"Symbol.prototype.valueOf",this);
}
return %_ValueOf(this);
}
function SymbolFor(n){
n=(%_ToString(n));
var o=%SymbolRegistry();
if((o.for[n]===(void 0))){
var p=%CreateSymbol(n);
o.for[n]=p;
o.keyFor[p]=n;
}
return o.for[n];
}
function SymbolKeyFor(p){
if(!(typeof(p)==='symbol'))throw h(148,p);
return %SymbolRegistry().keyFor[p];
}
function ObjectGetOwnPropertySymbols(q){
q=(%_ToObject(q));
return %GetOwnPropertyKeys(q,8);
}
%FunctionSetPrototype(d,new c());
b.InstallConstants(d,[
"iterator",g,
"toPrimitive",i,
"unscopables",k,
]);
b.InstallFunctions(d,2,[
"for",SymbolFor,
"keyFor",SymbolKeyFor
]);
%AddNamedProperty(
d.prototype,"constructor",d,2);
%AddNamedProperty(
d.prototype,j,"Symbol",2|1);
b.InstallFunctions(d.prototype,2|1,[
i,SymbolToPrimitive
]);
b.InstallFunctions(d.prototype,2,[
"toString",SymbolToString,
"valueOf",SymbolValueOf
]);
b.InstallFunctions(c,2,[
"getOwnPropertySymbols",ObjectGetOwnPropertySymbols
]);
b.Export(function(r){
r.SymbolToString=SymbolToString;
})
})

array¦±
(function(a,b,c){
"use strict";
%CheckIsBootstrapping();
var d;
var e;
var f;
var g;
var h;
var i=a.Array;
var j=b.InternalArray;
var k=b.InternalPackedArray;
var l;
var m;
var n;
var o;
var p;
var q=b.ImportNow("object_to_string");
var r;
var s;
var t;
var u;
var v=b.ImportNow("iterator_symbol");
var w=b.ImportNow("unscopables_symbol");
b.Import(function(x){
d=x.AddIndexedProperty;
g=x.GetIterator;
h=x.GetMethod;
l=x.MakeTypeError;
m=x.MaxSimple;
n=x.MinSimple;
o=x.ObjectDefineProperty;
p=x.ObjectHasOwnProperty;
r=x.ObserveBeginPerformSplice;
s=x.ObserveEndPerformSplice;
t=x.ObserveEnqueueSpliceRecord;
u=x.SameValueZero;
});
b.ImportFromExperimental(function(x){
e=x.FLAG_harmony_tolength;
f=x.FLAG_harmony_species;
});
function ArraySpeciesCreate(y,z){
var A;
if(f){
A=%ArraySpeciesConstructor(y);
}else{
A=i;
}
return new A(z);
}
function DefineIndexedProperty(y,B,C){
if(f){
var D=o(y,B,{
value:C,writable:true,configurable:true,enumerable:true
});
if(!D)throw l(137,B);
}else{
d(y,B,C);
}
}
var E=new j();
function GetSortedArrayKeys(y,F){
var G=new j();
if((typeof(F)==='number')){
var H=F;
for(var B=0;B<H;++B){
var I=y[B];
if(!(I===(void 0))||B in y){
G.push(B);
}
}
}else{
var z=F.length;
for(var J=0;J<z;++J){
var K=F[J];
if(!(K===(void 0))){
var I=y[K];
if(!(I===(void 0))||K in y){
G.push(K);
}
}
}
G.sort(function(L,M){return L-M;});
}
return G;
}
function SparseJoinWithSeparatorJS(y,N,O,P){
var G=GetSortedArrayKeys(y,%GetArrayKeys(y,N));
var Q=0;
var R=new j(G.length*2);
var S=-1;
for(var B=0;B<G.length;B++){
var K=G[B];
if(K!=S){
var I=y[K];
if(!(typeof(I)==='string'))I=O(I);
R[B*2]=K;
R[B*2+1]=I;
S=K;
}
}
return %SparseJoinWithSeparator(R,N,P);
}
function SparseJoin(y,N,O){
var G=GetSortedArrayKeys(y,%GetArrayKeys(y,N));
var T=-1;
var U=G.length;
var R=new j(U);
var V=0;
for(var B=0;B<U;B++){
var K=G[B];
if(K!=T){
var I=y[K];
if(!(typeof(I)==='string'))I=O(I);
R[V++]=I;
T=K;
}
}
return %StringBuilderConcat(R,V,'');
}
function UseSparseVariant(y,z,W,X){
if(!W||z<1000||%IsObserved(y)||
%HasComplexElements(y)){
return false;
}
if(!%_IsSmi(z)){
return true;
}
var Y=z>>2;
var Z=%EstimateNumberOfElements(y);
return(Z<Y)&&
(X>Z*4);
}
function Join(y,z,P,O){
if(z==0)return'';
var W=(%_IsArray(y));
if(W){
if(!%PushIfAbsent(E,y))return'';
}
try{
if(UseSparseVariant(y,z,W,z)){
%NormalizeElements(y);
if(P.length==0){
return SparseJoin(y,z,O);
}else{
return SparseJoinWithSeparatorJS(y,z,O,P);
}
}
if(z==1){
var I=y[0];
if((typeof(I)==='string'))return I;
return O(I);
}
var R=new j(z);
if(P.length==0){
var V=0;
for(var B=0;B<z;B++){
var I=y[B];
if(!(typeof(I)==='string'))I=O(I);
R[V++]=I;
}
R.length=V;
var D=%_FastOneByteArrayJoin(R,'');
if(!(D===(void 0)))return D;
return %StringBuilderConcat(R,V,'');
}
if(!(typeof(y[0])==='number')){
for(var B=0;B<z;B++){
var I=y[B];
if(!(typeof(I)==='string'))I=O(I);
R[B]=I;
}
}else{
for(var B=0;B<z;B++){
var I=y[B];
if((typeof(I)==='number')){
I=%_NumberToString(I);
}else if(!(typeof(I)==='string')){
I=O(I);
}
R[B]=I;
}
}
var D=%_FastOneByteArrayJoin(R,P);
if(!(D===(void 0)))return D;
return %StringBuilderJoin(R,z,P);
}finally{
if(W)E.length=E.length-1;
}
}
function ConvertToString(aa){
if((aa==null)){
return'';
}else{
return(%_ToString(aa));
}
}
function ConvertToLocaleString(I){
if((I==null)){
return'';
}else{
return(%_ToString(I.toLocaleString()));
}
}
function SparseSlice(y,ab,ac,N,ad){
var F=%GetArrayKeys(y,ab+ac);
if((typeof(F)==='number')){
var H=F;
for(var B=ab;B<H;++B){
var ae=y[B];
if(!(ae===(void 0))||B in y){
DefineIndexedProperty(ad,B-ab,ae);
}
}
}else{
var z=F.length;
for(var J=0;J<z;++J){
var K=F[J];
if(!(K===(void 0))){
if(K>=ab){
var ae=y[K];
if(!(ae===(void 0))||K in y){
DefineIndexedProperty(ad,K-ab,ae);
}
}
}
}
}
}
function SparseMove(y,ab,ac,N,af){
if(af===ac)return;
var ag=new j(
n(N-ac+af,0xffffffff));
var ah;
var F=%GetArrayKeys(y,N);
if((typeof(F)==='number')){
var H=F;
for(var B=0;B<ab&&B<H;++B){
var ae=y[B];
if(!(ae===(void 0))||B in y){
ag[B]=ae;
}
}
for(var B=ab+ac;B<H;++B){
var ae=y[B];
if(!(ae===(void 0))||B in y){
ag[B-ac+af]=ae;
}
}
}else{
var z=F.length;
for(var J=0;J<z;++J){
var K=F[J];
if(!(K===(void 0))){
if(K<ab){
var ae=y[K];
if(!(ae===(void 0))||K in y){
ag[K]=ae;
}
}else if(K>=ab+ac){
var ae=y[K];
if(!(ae===(void 0))||K in y){
var ai=K-ac+af;
ag[ai]=ae;
if(ai>0xfffffffe){
ah=ah||new j();
ah.push(ai);
}
}
}
}
}
}
%MoveArrayContents(ag,y);
if(!(ah===(void 0))){
var z=ah.length;
for(var B=0;B<z;++B){
var K=ah[B];
y[K]=ag[K];
}
}
}
function SimpleSlice(y,ab,ac,N,ad){
var W=(%_IsArray(y));
for(var B=0;B<ac;B++){
var aj=ab+B;
if(((W&&%_HasFastPackedElements(%IS_VAR(y)))?(aj<y.length):(aj in y))){
var ae=y[aj];
DefineIndexedProperty(ad,B,ae);
}
}
}
function SimpleMove(y,ab,ac,N,af){
var W=(%_IsArray(y));
if(af!==ac){
if(af>ac){
for(var B=N-ac;B>ab;B--){
var ak=B+ac-1;
var al=B+af-1;
if(((W&&%_HasFastPackedElements(%IS_VAR(y)))?(ak<y.length):(ak in y))){
y[al]=y[ak];
}else{
delete y[al];
}
}
}else{
for(var B=ab;B<N-ac;B++){
var ak=B+ac;
var al=B+af;
if(((W&&%_HasFastPackedElements(%IS_VAR(y)))?(ak<y.length):(ak in y))){
y[al]=y[ak];
}else{
delete y[al];
}
}
for(var B=N;B>N-ac+af;B--){
delete y[B-1];
}
}
}
}
function ArrayToString(){
var y;
var am;
if((%_IsArray(this))){
am=this.join;
if(am===ArrayJoin){
return Join(this,this.length,',',ConvertToString);
}
y=this;
}else{
y=(%_ToObject(this));
am=y.join;
}
if(!(typeof(am)==='function')){
return %_Call(q,y);
}
return %_Call(am,y);
}
function InnerArrayToLocaleString(y,z){
var N=(e?(%_ToLength(z)):((z)>>>0));
if(N===0)return"";
return Join(y,N,',',ConvertToLocaleString);
}
function ArrayToLocaleString(){
var y=(%_ToObject(this));
var an=y.length;
return InnerArrayToLocaleString(y,an);
}
function InnerArrayJoin(P,y,z){
if((P===(void 0))){
P=',';
}else{
P=(%_ToString(P));
}
var D=%_FastOneByteArrayJoin(y,P);
if(!(D===(void 0)))return D;
if(z===1){
var I=y[0];
if((I==null))return'';
return(%_ToString(I));
}
return Join(y,z,P,ConvertToString);
}
function ArrayJoin(P){
if((%IS_VAR(this)===null)||(this===(void 0)))throw l(17,"Array.prototype.join");
var y=(%_ToObject(this));
var z=(e?(%_ToLength(y.length)):((y.length)>>>0));
return InnerArrayJoin(P,y,z);
}
function ObservedArrayPop(ao){
ao--;
var C=this[ao];
try{
r(this);
delete this[ao];
this.length=ao;
}finally{
s(this);
t(this,ao,[C],0);
}
return C;
}
function ArrayPop(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw l(17,"Array.prototype.pop");
var y=(%_ToObject(this));
var ao=(e?(%_ToLength(y.length)):((y.length)>>>0));
if(ao==0){
y.length=ao;
return;
}
if(%IsObserved(y))
return ObservedArrayPop.call(y,ao);
ao--;
var C=y[ao];
%DeleteProperty_Strict(y,ao);
y.length=ao;
return C;
}
function ObservedArrayPush(){
var ao=(e?(%_ToLength(this.length)):((this.length)>>>0));
var ap=%_ArgumentsLength();
try{
r(this);
for(var B=0;B<ap;B++){
this[B+ao]=%_Arguments(B);
}
var aq=ao+ap;
this.length=aq;
}finally{
s(this);
t(this,ao,[],ap);
}
return aq;
}
function ArrayPush(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw l(17,"Array.prototype.push");
if(%IsObserved(this))
return ObservedArrayPush.apply(this,arguments);
var y=(%_ToObject(this));
var ao=(e?(%_ToLength(y.length)):((y.length)>>>0));
var ap=%_ArgumentsLength();
if(ap>(1<<30)||(ao-(1<<30))+ap>9007199254740991-(1<<30)){
throw l(228,ap,ao);
}
for(var B=0;B<ap;B++){
y[B+ao]=%_Arguments(B);
}
var aq=ao+ap;
y.length=aq;
return aq;
}
function SparseReverse(y,N){
var G=GetSortedArrayKeys(y,%GetArrayKeys(y,N));
var ar=G.length-1;
var as=0;
while(as<=ar){
var B=G[as];
var at=G[ar];
var au=N-at-1;
var av,aw;
if(au<=B){
aw=at;
while(G[--ar]==at){}
av=au;
}
if(au>=B){
av=B;
while(G[++as]==B){}
aw=N-B-1;
}
var ax=y[av];
if(!(ax===(void 0))||av in y){
var ay=y[aw];
if(!(ay===(void 0))||aw in y){
y[av]=ay;
y[aw]=ax;
}else{
y[aw]=ax;
delete y[av];
}
}else{
var ay=y[aw];
if(!(ay===(void 0))||aw in y){
y[av]=ay;
delete y[aw];
}
}
}
}
function PackedArrayReverse(y,N){
var at=N-1;
for(var B=0;B<at;B++,at--){
var ax=y[B];
var ay=y[at];
y[B]=ay;
y[at]=ax;
}
return y;
}
function GenericArrayReverse(y,N){
var at=N-1;
for(var B=0;B<at;B++,at--){
if(B in y){
var ax=y[B];
if(at in y){
var ay=y[at];
y[B]=ay;
y[at]=ax;
}else{
y[at]=ax;
delete y[B];
}
}else{
if(at in y){
var ay=y[at];
y[B]=ay;
delete y[at];
}
}
}
return y;
}
function ArrayReverse(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw l(17,"Array.prototype.reverse");
var y=(%_ToObject(this));
var N=(e?(%_ToLength(y.length)):((y.length)>>>0));
var az=(%_IsArray(y));
if(UseSparseVariant(y,N,az,N)){
%NormalizeElements(y);
SparseReverse(y,N);
return y;
}else if(az&&%_HasFastPackedElements(y)){
return PackedArrayReverse(y,N);
}else{
return GenericArrayReverse(y,N);
}
}
function ObservedArrayShift(N){
var aA=this[0];
try{
r(this);
SimpleMove(this,0,1,N,0);
this.length=N-1;
}finally{
s(this);
t(this,0,[aA],0);
}
return aA;
}
function ArrayShift(